{"componentChunkName":"component---src-templates-blog-post-js","path":"/how-to-dynamically-run-step-on-each-github-pr-label/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://slashgear.github.io"}},"config":{"html":"<p>Written by <strong>Antoine Caron</strong> who lives and works in Lyon (France) building useful things at <a href=\"https://www.bedrockstreaming.com/\">Bedrock</a>.\nYou should follow him <a href=\"https://twitter.com/Slashgear_\">on Twitter</a>.\nTake a look at <a href=\"/friends-you-should-follow\">my friends websites</a>.\nYou could also <a href=\"/conferences\">take a look at the conferences I gave</a>.\nIf you want to see my professional background, <a href=\"/resume\">my resume is available here</a>.</p>","fields":{"slug":"/"},"frontmatter":{"title":"Antoine Caron","language":"en"}},"markdownRemark":{"id":"a18885cf-227c-5654-97f2-cfb7861679bc","excerpt":"For some time now Iâ€™ve been playing with github actions to see if I can easily reproduce behaviors I apply in my current CI tool.\nI wantedâ€¦","html":"<p>For some time now Iâ€™ve been playing with github actions to see if I can easily reproduce behaviors I apply in my current CI tool.\nI wanted to parallelize tasks on each label of a pull request.\nIn this article, I will show you a possible way to do it!</p>\n<p>In my work at <a href=\"https://www.bedrockstreaming.com/\">Bedrock</a>, we currently use Jenkins to manage our ongoing application integration and deployment.\nBeyond the various concerns of using groovy with pipeline syntax ðŸ˜…, we have to admit that we manage to do some pretty complex workflows.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/19010545e7456d3a5201b61a03e8a4ad/ddced/ci.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 194.00000000000003%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAnABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAIDAQX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB96LzjUUz1zLB2AoH/8QAFhABAQEAAAAAAAAAAAAAAAAAARAg/9oACAEBAAEFAmuGtZ//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AV//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AV//xAAUEAEAAAAAAAAAAAAAAAAAAAAw/9oACAEBAAY/An//xAAYEAACAwAAAAAAAAAAAAAAAAAQMQABEf/aAAgBAQABPyFJoSWWLGmof//aAAwDAQACAAMAAAAQu8w8c8//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EF//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EF//xAAcEAACAgMBAQAAAAAAAAAAAAABMQARECFxgUH/2gAIAQEAAT8QCiNkewl9JO4EI2N7AsP7AsM7AsVtN2Lx/9k='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/19010545e7456d3a5201b61a03e8a4ad/f13a9/ci.avif 200w,\n/static/19010545e7456d3a5201b61a03e8a4ad/af71e/ci.avif 400w,\n/static/19010545e7456d3a5201b61a03e8a4ad/c9875/ci.avif 800w,\n/static/19010545e7456d3a5201b61a03e8a4ad/e449d/ci.avif 1100w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/avif\"\n            /><source\n              srcset=\"/static/19010545e7456d3a5201b61a03e8a4ad/ba381/ci.webp 200w,\n/static/19010545e7456d3a5201b61a03e8a4ad/7f61c/ci.webp 400w,\n/static/19010545e7456d3a5201b61a03e8a4ad/d00b9/ci.webp 800w,\n/static/19010545e7456d3a5201b61a03e8a4ad/abb12/ci.webp 1100w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/19010545e7456d3a5201b61a03e8a4ad/e07e9/ci.jpg 200w,\n/static/19010545e7456d3a5201b61a03e8a4ad/066f9/ci.jpg 400w,\n/static/19010545e7456d3a5201b61a03e8a4ad/4b190/ci.jpg 800w,\n/static/19010545e7456d3a5201b61a03e8a4ad/ddced/ci.jpg 1100w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/19010545e7456d3a5201b61a03e8a4ad/4b190/ci.jpg\"\n            alt=\"example of complex Continous Integration workflow\"\n            title=\"example of complex Continous Integration workflow\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Deciding to see if it would be easy for me to reproduce the steps of these pipelines with github action, I decided to try its features.\nAmong other things by publishing <a href=\"https://github.com/Slashgear/action-check-pr-title\">a Github Action to check the title of a PR according to a regexp.</a></p>\n<h2 id=\"solution\" style=\"position:relative;\"><a href=\"#solution\" aria-label=\"solution permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Solution</h2>\n<p>First you need to create a workflow based on <code class=\"language-text\">pull_request</code> events and you can even specify the types of events.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Example workflow\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">pull_request</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">types</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>opened<span class=\"token punctuation\">,</span> labeled<span class=\"token punctuation\">,</span> unlabeled<span class=\"token punctuation\">,</span> synchronize<span class=\"token punctuation\">]</span></code></pre></div>\n<p>Now add a job that will set up a parallelization strategy based on the labels of the github event.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">strategy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">matrix</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">label</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>github.event.pull_request.labels.<span class=\"token important\">*.name</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Run a one<span class=\"token punctuation\">-</span>line script\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> echo Hello<span class=\"token punctuation\">,</span> world from \"$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>matrix.label<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\"<span class=\"token tag\">!</span></code></pre></div>\n<p>This will automatically run the steps in parallel on all the labels of each Pull Request. ðŸŽ‰\nHowever, <code class=\"language-text\">strategy.matrix.label</code> does not accept an empty array as a value.ðŸ˜¢</p>\n<p>The job should therefore be conditional so that it is only run if <code class=\"language-text\">${{github.event.pull_request.labels.*.name}}</code> is not empty.\nThere is an <code class=\"language-text\">if</code> parameter in the jobs that allows to do this, but unfortunately it is interpreted after checking the value of <code class=\"language-text\">strategy.matrix.label</code>.</p>\n<p>The solution I found is to do this check in a previous job.\nThis is an example of a workflow that dynamically launches actions on all the labels of each PR.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Example workflow\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">pull_request</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">types</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>opened<span class=\"token punctuation\">,</span> labeled<span class=\"token punctuation\">,</span> unlabeled<span class=\"token punctuation\">,</span> synchronize<span class=\"token punctuation\">]</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">checkLabels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>github.event.pull_request.labels.<span class=\"token important\">*.name</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> echo Check labels is not empty\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">needs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>checkLabels<span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">strategy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">matrix</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">label</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>github.event.pull_request.labels.<span class=\"token important\">*.name</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Run a one<span class=\"token punctuation\">-</span>line script\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> echo Hello<span class=\"token punctuation\">,</span> world from \"$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>matrix.label<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\"<span class=\"token tag\">!</span></code></pre></div>\n<p>Itâ€™s up to you to adapt it to your needs!</p>","headings":[{"value":"Solution"}],"wordCount":{"words":285},"tableOfContents":"<ul>\n<li><a href=\"#solution\">Solution</a></li>\n</ul>","frontmatter":{"title":"Github Action: How to dynamically run step on each PR label ?","date":"November 29, 2020","dateJson":"2020-11-29","translations":["fr","comment-parralelliser-un-job-github-action-par-label"],"description":"For some time now I've been playing with github actions to see if I can easily reproduce behaviors I apply in my current CI tool. I wanted to parallelize tasks on each label of a pull request.","language":"en","tags":["github","action","CI","tutorial"],"hero":{"childImageSharp":{"fluid":{"aspectRatio":1.9083969465648856,"src":"/static/ff44249e8985e61cdbe670afb0139b18/a7715/github-actions.jpg","srcSet":"/static/ff44249e8985e61cdbe670afb0139b18/8f7df/github-actions.jpg 250w,\n/static/ff44249e8985e61cdbe670afb0139b18/0f3a1/github-actions.jpg 500w,\n/static/ff44249e8985e61cdbe670afb0139b18/a7715/github-actions.jpg 1000w,\n/static/ff44249e8985e61cdbe670afb0139b18/47498/github-actions.jpg 1200w","srcWebp":"/static/ff44249e8985e61cdbe670afb0139b18/e30b5/github-actions.webp","srcSetWebp":"/static/ff44249e8985e61cdbe670afb0139b18/7ca0e/github-actions.webp 250w,\n/static/ff44249e8985e61cdbe670afb0139b18/e9589/github-actions.webp 500w,\n/static/ff44249e8985e61cdbe670afb0139b18/e30b5/github-actions.webp 1000w,\n/static/ff44249e8985e61cdbe670afb0139b18/99238/github-actions.webp 1200w","sizes":"(max-width: 1000px) 100vw, 1000px"},"image":{"src":"/static/ff44249e8985e61cdbe670afb0139b18/10d63/github-actions.jpg"},"image16x9":{"src":"/static/ff44249e8985e61cdbe670afb0139b18/6edcc/github-actions.jpg"},"image4x3":{"src":"/static/ff44249e8985e61cdbe670afb0139b18/e14ae/github-actions.jpg"},"image1x1":{"src":"/static/ff44249e8985e61cdbe670afb0139b18/db124/github-actions.jpg"}}}}},"relatedPosts":{"edges":[{"node":{"excerpt":"I decided this year to try the adventofcode2020 challenge in JS to see.\nI published the solutions I found in a public repository on Githubâ€¦","fields":{"slug":"/advent-of-code-2020/"},"timeToRead":1,"frontmatter":{"title":"ðŸŽ„ Advent of Code 2020 ðŸŽ„: my solutions with JS","date":"December 04, 2020","dateJson":"2020-12-04","description":"I decided this year to try the adventofcode2020 challenge in JS to see. I published the solutions I found in a public repository on Github.","tags":["js","oss","github","kata"]}}},{"node":{"excerpt":"Once again, I gave myself a challenge to learn how to use Github Action.\nI tried to see if it was possible to dynamically launch a job forâ€¦","fields":{"slug":"/how-to-split-test-by-folder-with-github-action/"},"timeToRead":1,"frontmatter":{"title":"Github Action: How to parallelize tests dynamically by folder?","date":"December 01, 2020","dateJson":"2020-12-01","description":"Once again, I play with Github Action to see if it can answer the CI problems I may encounter in my work.","tags":["github","action","CI","tutorial"]}}},{"node":{"excerpt":"Github Pages is a solution to host static websites directly in your Github repository by pushing site files to  branch.\nI use this featureâ€¦","fields":{"slug":"/how-to-deploy-on-github-pages-with-travis-ci/"},"timeToRead":2,"frontmatter":{"title":"How to deploy on Github Pages with Travis CI?","date":"May 26, 2020","dateJson":"2020-05-26","description":"How to automate in a few minutes the deployment of your site on Github Pages with the Travis CI tool. This is a step-by-step tutorial describing all the actions to perform to publish a static site on Github Pages and host it for free.","tags":["tutorial","github","gatsby"]}}}]}},"pageContext":{"slug":"/how-to-dynamically-run-step-on-each-github-pr-label/","tags":["github","action","CI","tutorial"],"language":"en","previous":{"fields":{"slug":"/how-to-deploy-on-github-pages-with-travis-ci/"},"frontmatter":{"title":"How to deploy on Github Pages with Travis CI?","tags":["tutorial","github","gatsby"]}},"next":{"fields":{"slug":"/how-to-split-test-by-folder-with-github-action/"},"frontmatter":{"title":"Github Action: How to parallelize tests dynamically by folder?","tags":["github","action","CI","tutorial"]}}}},"staticQueryHashes":["1264045386","1666466174","2564629789","4061151221","62118570"]}