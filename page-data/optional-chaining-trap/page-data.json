{"componentChunkName":"component---src-templates-blog-post-js","path":"/optional-chaining-trap/","result":{"data":{"site":{"siteMetadata":{"repository":"https://github.com/Slashgear/slashgear.github.io"}},"config":{"html":"<p>Written by <strong>Antoine Caron</strong> who lives and works in Lyon (France) building useful things at <a href=\"https://www.bedrockstreaming.com/\">Bedrock</a>.\nYou should follow him <a href=\"https://twitter.com/Slashgear_\">on Twitter</a></p>","fields":{"slug":"/"},"frontmatter":{"title":"Antoine Caron","language":"en"}},"markdownRemark":{"id":"c856ef83-d3ea-52b9-af9a-82778c7c08e4","excerpt":"A few days ago, an announcement that many expected was published in TC39 Stage 3. Optional Chaining Example here with It is a great news for‚Ä¶","html":"<p>A few days ago, an announcement that many expected was published in TC39 Stage 3. <strong>Optional Chaining</strong></p>\n<p>Example here with</p>\n<blockquote class=\"twitter-tweet\"><p lang=\"en\" dir=\"ltr\">üéâüéâüéâüéâBREAKING: <a href=\"https://twitter.com/hashtag/TC39?src=hash&amp;ref_src=twsrc%5Etfw\">#TC39</a>: Optional Chaining has now moved to Stage 3!!! <a href=\"https://twitter.com/hashtag/JavaScript?src=hash&amp;ref_src=twsrc%5Etfw\">#JavaScript</a> <a href=\"https://t.co/mUjJRXiOZx\">pic.twitter.com/mUjJRXiOZx</a></p>&mdash; Sean Thomas Larkin ÂªñËÇñÊÅ© (@TheLarkInn) <a href=\"https://twitter.com/TheLarkInn/status/1154456929898385408?ref_src=twsrc%5Etfw\">July 25, 2019</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n<p>It is a <strong>great news</strong> for Javascript ! This feature is awesome but‚Ä¶</p>\n<p>Please agree with me, this feature will not be available tomorrow in our browsers. In stage 3, it is very likely that this feature will be added in the next release of ES.</p>\n<h1 id=\"but\" style=\"position:relative;\"><a href=\"#but\" aria-label=\"but permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>But</h1>\n<p>We will need to babel it for a very long time.</p>\n<p>If you take a look at <a href=\"https://babeljs.io/docs/en/babel-plugin-proposal-optional-chaining\">@babel/plugin-proposal-optional-chaining</a>, this is how babel will transpile it.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA+UlEQVQoz62SW0+EMBCF+f9/0Jggi+Jm47oIdHqhl+lxaHlQE5PF2OTLmYfO6VzaTLPC6iP+4+Sc0Xh3Q/JXcBiF264HiKPkvyOFqZg2Tg9w1CKHV6T15U9E1yOul2qoNWFZZmzKvLXOUno6DLLklQqph1seEPQTgqkkdzpAj2BbYdhbtrO0/CaMWK3gJnCiA+iiOdlqaOgKtZyh1QXRf0jHSgY9ywVBlO9BFsJRVcPVDAj0iGRPWKmTuEM0W9zCmw5cBv/8K1yWIjnuXA2ts2UhRN9RpGAMIaZ4F4nTXqH3MNZKckUbA9Km6PZY4rzDX+KfsPyQXAw/AUu4CmU0DqFWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/5e332fb09af3fd8001ac2612fd3221b2/ba381/babel-doc.webp 200w,\n/static/5e332fb09af3fd8001ac2612fd3221b2/7f61c/babel-doc.webp 400w,\n/static/5e332fb09af3fd8001ac2612fd3221b2/d00b9/babel-doc.webp 800w,\n/static/5e332fb09af3fd8001ac2612fd3221b2/92f8c/babel-doc.webp 1200w,\n/static/5e332fb09af3fd8001ac2612fd3221b2/fad48/babel-doc.webp 1600w,\n/static/5e332fb09af3fd8001ac2612fd3221b2/a3f95/babel-doc.webp 2370w\"\n          sizes=\"(max-width: 800px) 100vw, 800px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/5e332fb09af3fd8001ac2612fd3221b2/772e8/babel-doc.png 200w,\n/static/5e332fb09af3fd8001ac2612fd3221b2/e17e5/babel-doc.png 400w,\n/static/5e332fb09af3fd8001ac2612fd3221b2/5a190/babel-doc.png 800w,\n/static/5e332fb09af3fd8001ac2612fd3221b2/c1b63/babel-doc.png 1200w,\n/static/5e332fb09af3fd8001ac2612fd3221b2/29007/babel-doc.png 1600w,\n/static/5e332fb09af3fd8001ac2612fd3221b2/59f0d/babel-doc.png 2370w\"\n          sizes=\"(max-width: 800px) 100vw, 800px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/5e332fb09af3fd8001ac2612fd3221b2/5a190/babel-doc.png\"\n          alt=\"babel transpile example\"\n          title=\"babel transpile example\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n    </span></p>\n<p>This is kind of a very verbose output.</p>\n<p>Let‚Äôs imagine that we use this feature very many times in a web application, and you use it for deep case.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> foo <span class=\"token operator\">=</span> everything<span class=\"token operator\">?.</span>could<span class=\"token operator\">?.</span>be<span class=\"token punctuation\">.</span>nullable<span class=\"token operator\">?.</span>maybe\n\n<span class=\"token comment\">// Babel will generate this output</span>\n\n<span class=\"token keyword\">var</span> _everything<span class=\"token punctuation\">,</span> _everything$could<span class=\"token punctuation\">,</span> _everything$could$be$\n\n<span class=\"token keyword\">var</span> foo <span class=\"token operator\">=</span>\n  <span class=\"token punctuation\">(</span>_everything <span class=\"token operator\">=</span> everything<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> _everything <span class=\"token operator\">===</span> <span class=\"token keyword\">void</span> <span class=\"token number\">0</span>\n    <span class=\"token operator\">?</span> <span class=\"token keyword\">void</span> <span class=\"token number\">0</span>\n    <span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>_everything$could <span class=\"token operator\">=</span> _everything<span class=\"token punctuation\">.</span>could<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span>\n      _everything$could <span class=\"token operator\">===</span> <span class=\"token keyword\">void</span> <span class=\"token number\">0</span>\n    <span class=\"token operator\">?</span> <span class=\"token keyword\">void</span> <span class=\"token number\">0</span>\n    <span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>_everything$could$be$ <span class=\"token operator\">=</span> _everything$could<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>nullable<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span>\n      _everything$could$be$ <span class=\"token operator\">===</span> <span class=\"token keyword\">void</span> <span class=\"token number\">0</span>\n    <span class=\"token operator\">?</span> <span class=\"token keyword\">void</span> <span class=\"token number\">0</span>\n    <span class=\"token operator\">:</span> _everything$could$be$<span class=\"token punctuation\">.</span>maybe\n\n<span class=\"token comment\">// Terser would modify like this</span>\nl<span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">,</span> o\n<span class=\"token keyword\">null</span> <span class=\"token operator\">===</span> <span class=\"token punctuation\">(</span>l <span class=\"token operator\">=</span> everything<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n  <span class=\"token keyword\">void</span> <span class=\"token number\">0</span> <span class=\"token operator\">===</span> l <span class=\"token operator\">||</span>\n  <span class=\"token keyword\">null</span> <span class=\"token operator\">===</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">=</span> l<span class=\"token punctuation\">.</span>could<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n  <span class=\"token keyword\">void</span> <span class=\"token number\">0</span> <span class=\"token operator\">===</span> n <span class=\"token operator\">||</span>\n  <span class=\"token keyword\">null</span> <span class=\"token operator\">===</span> <span class=\"token punctuation\">(</span>o <span class=\"token operator\">=</span> n<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>nullable<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n  <span class=\"token keyword\">void</span> <span class=\"token number\">0</span> <span class=\"token operator\">===</span> o <span class=\"token operator\">||</span>\n  o<span class=\"token punctuation\">.</span>maybe</code></pre></div>\n<p>It‚Äôs going to be really verbose in your bundles. The transformation made by babel in the state does not at all share the <em>nullsafe</em> access mechanism as <code class=\"language-text\">lodash.get</code> can do. Even if <em>lodash</em> is very/too heavy. It offers a more efficient nullsafe implementation while generating less code.</p>\n<p>You‚Äôre going to tell me,</p>\n<blockquote>\n<p>‚ÄúWhat the heck! Antoine, it‚Äôs not the first time we‚Äôve used a not-so-great polyfill to be able to use a new feature of EcmaScript‚Äù</p>\n</blockquote>\n<h1 id=\"yeah\" style=\"position:relative;\"><a href=\"#yeah\" aria-label=\"yeah permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Yeah</h1>\n<p>Ok but this time we can still look a few minutes to propose an implementation of a less trivial polyfill. This solution cannot really be applied in a world where the web developer turns into a <code class=\"language-text\">Ko</code> hunter.</p>\n<p>Let‚Äôs look at how <code class=\"language-text\">lodash.get</code> works. <a href=\"https://github.com/lodash/lodash/blob/master/.internal/baseGet.js\">Github link</a></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> castPath <span class=\"token keyword\">from</span> <span class=\"token string\">'./castPath.js'</span>\n<span class=\"token keyword\">import</span> toKey <span class=\"token keyword\">from</span> <span class=\"token string\">'./toKey.js'</span>\n\n<span class=\"token comment\">/**\n * The base implementation of `get` without support for default values.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @returns {*} Returns the resolved value.\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">baseGet</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">object<span class=\"token punctuation\">,</span> path</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  path <span class=\"token operator\">=</span> <span class=\"token function\">castPath</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> object<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">let</span> index <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n  <span class=\"token keyword\">const</span> length <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span>length\n\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>object <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> index <span class=\"token operator\">&lt;</span> length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    object <span class=\"token operator\">=</span> object<span class=\"token punctuation\">[</span><span class=\"token function\">toKey</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">[</span>index<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> index <span class=\"token operator\">&amp;&amp;</span> index <span class=\"token operator\">==</span> length <span class=\"token operator\">?</span> object <span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> baseGet</code></pre></div>\n<p>It‚Äôs very effective (very compact). What if the polyfill of <strong>the Optional Chaining</strong> involved the application of a utility function like <code class=\"language-text\">lodash.get</code>?</p>\n<p>What‚Äôs your opinion on that?</p>\n<p>Feel free to share and react if you liked this article.</p>","headings":[{"value":"But"},{"value":"Yeah"}],"tableOfContents":"<ul>\n<li><a href=\"/optional-chaining-trap/#but\">But</a></li>\n<li><a href=\"/optional-chaining-trap/#yeah\">Yeah</a></li>\n</ul>","frontmatter":{"title":"üò∞ Optional chaining trap !","date":"July 31, 2019","translations":null,"description":"Sometimes a new feature for ES should not be used immediately. Polyfill can sometimes be very heavy.","hero":{"childImageSharp":{"fluid":{"aspectRatio":1.7605633802816902,"src":"/static/c2801aa67723e811b6a9b8fe23d62272/9104c/cat.jpg","srcSet":"/static/c2801aa67723e811b6a9b8fe23d62272/8f7df/cat.jpg 250w,\n/static/c2801aa67723e811b6a9b8fe23d62272/9104c/cat.jpg 480w","srcWebp":"/static/c2801aa67723e811b6a9b8fe23d62272/61be4/cat.webp","srcSetWebp":"/static/c2801aa67723e811b6a9b8fe23d62272/7ca0e/cat.webp 250w,\n/static/c2801aa67723e811b6a9b8fe23d62272/61be4/cat.webp 480w","sizes":"(max-width: 480px) 100vw, 480px"},"image":{"src":"/static/c2801aa67723e811b6a9b8fe23d62272/9104c/cat.jpg"}}}}}},"pageContext":{"slug":"/optional-chaining-trap/","language":"en","previous":{"fields":{"slug":"/discover-jest-hidden-feature-automock/"},"frontmatter":{"title":"Discover Jest hidden feature: Automock"}},"next":{"fields":{"slug":"/hunting-webpack-performances/"},"frontmatter":{"title":"How to boost the speed of your webpack build?"}}}}}