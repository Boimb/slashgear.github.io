{"componentChunkName":"component---src-templates-blog-post-js","path":"/webpack-an-unexpected-journey/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://slashgear.github.io"}},"config":{"html":"<p>Written by <strong>Antoine Caron</strong> who lives and works in Lyon (France) building useful things at <a href=\"https://www.bedrockstreaming.com/\">Bedrock</a>.\nYou should follow him <a href=\"https://twitter.com/Slashgear_\">on Twitter</a>.\nTake a look at <a href=\"/friends-you-should-follow\">my friends websites</a>.</p>","fields":{"slug":"/"},"frontmatter":{"title":"Antoine Caron","language":"en"}},"markdownRemark":{"id":"aad46f5a-7125-5e20-a8de-7762f1974bf7","excerpt":"Webpack : an unexpected journey In an open space worked a frontend developper. Not a nasty or a dirty app maker. He had been doing HTML, CSS…","html":"<h3 id=\"webpack--an-unexpected-journey\" style=\"position:relative;\"><a href=\"#webpack--an-unexpected-journey\" aria-label=\"webpack  an unexpected journey permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Webpack : an unexpected journey</h3>\n<p><em>In an open space worked a frontend developper. Not a nasty or a dirty app maker. He had been doing HTML, CSS and JS for many years. He had known dark ages when all those word meant danger and trouble. Many years after the golden age of One day One JS webapp framework, he did not know a new initiation quest was coming to him: Web app performances.</em></p>\n<p><img src=\"/f4b9644afc731127aa05ac39bb104337/bilbo-running.gif\" alt=\"In a hole in the ground there lived a hobbit\"></p>\n<h3 id=\"what-is-webpack-\" style=\"position:relative;\"><a href=\"#what-is-webpack-\" aria-label=\"what is webpack  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What is Webpack ?</h3>\n<blockquote>\n<p>“It’s main purpose is to bundle JS files for use in a browser application” — Burke Holland (with <a href=\"https://medium.com/u/393110b0b9e4\">Sean T. Larkin</a> on <strong>Five things about webpack</strong> )</p>\n</blockquote>\n<p>Webpack builds one or many JS output by resolving JS modules dependencies from one or many entries. Entry could be for example the file responsible of bootstrapping your favourite JS UI library. Outputs are mainly JS files called bundles, they gather all the modules loaded by Webpack when it creates the dependency tree. It can also handle other file types like assets (images/html/…) thanks to <em>loader</em>.</p>\n<p>If you don’t feel familiar enough with core concepts like Loaders, Plugins, Modules, I encourage you to watch this short video where <a href=\"https://medium.com/u/393110b0b9e4\">Sean T. Larkin</a> explains in a few sentences what mysteries are hidden behind these words.</p>\n<div class=\"gatsby-resp-iframe-wrapper\" style=\"padding-bottom: 56.25%; position: relative; height: 0; overflow: hidden; margin-bottom: 1.0725rem\" > <iframe src=\"https://www.youtube-nocookie.com/embed/WI6OTVXT6k8\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen style=\" position: absolute; top: 0; left: 0; width: 100%; height: 100%; \"></iframe> </div>\n<h3 id=\"why-is-it-often-considered-as-a-burden-in-the-project-\" style=\"position:relative;\"><a href=\"#why-is-it-often-considered-as-a-burden-in-the-project-\" aria-label=\"why is it often considered as a burden in the project  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Why is it often considered as a burden in the project ?</h3>\n<h4 id=\"unreachable-best-practices\" style=\"position:relative;\"><a href=\"#unreachable-best-practices\" aria-label=\"unreachable best practices permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unreachable best practices</h4>\n<p>Thanks to a huge community and an open API, Webpack is clearly a trendy project on NPM. Released for the first time in 2012, Webpack has seen a lot of changes since then.</p>\n<p>Like any new concept, Webpack needs time to mature: Its use has evolved. To do pretty much the same thing, there were sometimes 3 loaders / plugins. It was difficult to understand how to use it correctly when every article or example shows us a different way of doing things.</p>\n<p><img src=\"/6ed6b7b74d0294859c3bf9c35227c050/thering.gif\" alt=\"One webpack configuration to rule them all…\"></p>\n<p>In addition, we must remain objective, Webpack has never been the best documented tool in history. We can still note that a lot of efforts have been put in past few years.</p>\n<p>In addition, migrating to new versions of Webpack is still painful. You will always have a plugin or a loader not supporting the last version.</p>\n<p>Personally, version migrations in which I was able to participate were very often a source of regressions on our applications (loss of performances, memory leak, …)</p>\n<h4 id=\"the-multiple-environnement-trap\" style=\"position:relative;\"><a href=\"#the-multiple-environnement-trap\" aria-label=\"the multiple environnement trap permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The multiple environnement trap</h4>\n<p>Our modern uses push us to create environments to test our applications before our users.</p>\n<p>We usually have a very different environment:</p>\n<ul>\n<li>minification / uglyfication of the code is avoided.</li>\n<li>we replace our modules in the browser (HMR).</li>\n</ul>\n<p><img src=\"/dc4371a89c700fc54b46dd211ff63949/run-you-fools.gif\" alt=\"Run you fools\"></p>\n<p>In order to avoid configuration duplication, we are tempted to set up conditions based on variables from environment passed to the build.</p>\n<p>By fear of duplicating our code, we often split our configuration in/between many files.</p>\n<p>We then find ourselves with a configuration that is often difficult to read and difficult to understand as whole.</p>\n<h4 id=\"light-of-eärendil\" style=\"position:relative;\"><a href=\"#light-of-e%C3%A4rendil\" aria-label=\"light of eärendil permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><em>Light of <a href=\"http://lotr.wikia.com/wiki/E%C3%A4rendil\">Eärendil</a></em></h4>\n<p><img src=\"/6e557270c00f395e1abd798c5c9f9b6a/light.gif\" alt=\"Light of Eärendil\"></p>\n<p>A good practice to avoid this trap is to use a tool like <a href=\"https://github.com/survivejs/webpack-merge\">webpack-merge</a> to build a basic configuration that can be extended if necessary (add a plugin, change the configuration of a loader, etc.)</p>\n<p>Another solution for functionnal aficionados is to use <a href=\"https://github.com/neutrinojs/webpack-chain\">webpack-chain</a>.</p>\n<blockquote>\n<p>Webpack’s core configuration is based on creating and modifying a potentially unwieldy JavaScript object. While this is OK for configurations on individual projects, trying to share these objects across projects and make subsequent modifications gets messy, as you need to have a deep understanding of the underlying object structure to make those changes.</p>\n</blockquote>\n<blockquote>\n<p>webpack-chain attempts to improve this process by providing a chainable or fluent API for creating and modifying webpack configurations. Key portions of the API can be referenced by user-specified names, which helps to standardize how to modify a configuration across projects.</p>\n</blockquote>\n<blockquote>\n<p><strong>— Webpack-chain self description</strong></p>\n</blockquote>\n<p>If you find your webpack configuration too complex, I can only recommend that you test these two tools. Many tools have taken the plunge this year. I would mention in particular Vue-cli 3 which is based on an ad hoc dynamic Webpack configuration. I refer you to <a href=\"https://medium.com/u/4f198f5f1f12\">Evan You</a>‘s <a href=\"https://medium.com/the-vue-point/vue-cli-3-0-is-here-c42bebe28fbb\">article on the subject.</a></p>\n<h3 id=\"why-webpack-is-a-great-tool-for-making-your-web-app-performant-\" style=\"position:relative;\"><a href=\"#why-webpack-is-a-great-tool-for-making-your-web-app-performant-\" aria-label=\"why webpack is a great tool for making your web app performant  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Why Webpack is a great tool for making your web app performant ?</h3>\n<p>This lib allows us to optimize our application in different ways, I will not make the complete list here. However, we can generalize by saying that Webpack can bring performance to your web application by reducing the amount of code in it.</p>\n<h4 id=\"code-splitting\" style=\"position:relative;\"><a href=\"#code-splitting\" aria-label=\"code splitting permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Code splitting</h4>\n<p>Webpack does not only merge modules into a large file by solving dependencies. It can also split your applications into multiple batches. These smaller batches can help you avoid to load less code on your application’s home page and reduce its time to interactive.</p>\n<p>You can achieve this in many ways:</p>\n<p><a href=\"https://webpack.js.org/guides/code-splitting/#entry-points\"><strong>Entry points:</strong></a> You could define all the different entries to generate many output. It is great to control exactly the generated bundles by viewing it directly in your entry definition.</p>\n<p><a href=\"https://webpack.js.org/guides/code-splitting/#dynamic-imports\"><strong>Dynamic import decoration:</strong></a> Importing code in ES code is pretty simple, but it requires all your code to already be loaded. A TC39 proposal introduced a dynamic way to import code in your Javascript.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> element <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> _ <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/* webpackChunkName: \"lodash\" */</span> <span class=\"token string\">'lodash'</span><span class=\"token punctuation\">)</span>\n\n  element<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Hello'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'webpack'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">' '</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> element\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">getComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">component</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>component<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>With this simple trick, you can generate a second bundle containing <em>lodash</em> which will be requested in a second time.</p>\n<p>Note that you can tell Webpack that this async module should be <a href=\"https://webpack.js.org/guides/code-splitting/#prefetching-preloading-modules\">prefetched during browser idle time.</a></p>\n<p>With a component based framework like React, the second approach is the one you should consider. In a Single Page App, using <em>dynamic import</em> in your router configuration will reduce the amount of code loaded drastically.</p>\n<p>Tricky parts with code splitting are mainly:</p>\n<ul>\n<li>handling case where some modules are necessary in many bundles.</li>\n<li>Serving code needed for the page your user is on.</li>\n</ul>\n<h4 id=\"tree-shaking\" style=\"position:relative;\"><a href=\"#tree-shaking\" aria-label=\"tree shaking permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tree shaking</h4>\n<p>Ok now you know how to avoid loading all your code app in your first page. But you may still load part of modules you don’t really need. That is called, <em>dead code</em>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">square</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> x <span class=\"token operator\">*</span> x\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">cube</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> x <span class=\"token operator\">*</span> x <span class=\"token operator\">*</span> x\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>If you load this module in your app for just the square function, by default, Webpack will still load <em>cube</em> function and put it in the bundle.</p>\n<p><img src=\"/9b32ba1a1d1d843d8394c7f5e22fa205/smeagold.gif\" alt=\"smeagold\"></p>\n<p>Now think about all the <em>dead code</em> you are loading in your application. To avoid that, you have to tell Webpack that your modules don’t have side effects by following <a href=\"https://webpack.js.org/guides/tree-shaking/#mark-the-file-as-side-effect-free\">this documentation</a>.</p>\n<p>Let’s take another example, I’m pretty sure you have already used <em>lodash</em> in one of your apps. However, you likely never used more than 30% of it . Here the <em>side effects</em> trick will not do the job : lodash doesn’t use exports and defines all his functions in one big file.</p>\n<p>To avoid that huge <em>lodash</em> in your app, you should consider using this <a href=\"https://github.com/lodash/babel-plugin-lodash\">babel-plugin-lodash</a> or importing every time the module which is only exporting the function you need:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> \\_merge <span class=\"token keyword\">from</span> <span class=\"token string\">'lodash/merge'</span></code></pre></div>\n<h3 id=\"case-study-6play-a-white-mark-vod-platform\" style=\"position:relative;\"><a href=\"#case-study-6play-a-white-mark-vod-platform\" aria-label=\"case study 6play a white mark vod platform permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Case study: 6play a white mark VOD platform</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.499999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/0lEQVQI1wH0AAv/AF5NN3JmUHdeUpmJeKShjHF5eldgbWVmaWhrbVJRU0U/N09GP0NEV4CNt4WOo1dOVWZlb6u3zZies4KElABwRSiBZUp+Tzm9oIy8vqaFh4J2fIZbXFhfXVdjXltFMx9NRDU3KDyOhbKTmKB9XE50ZF6vwNKciZCGdXUAs49+qYhzkmtX1LCnxbasX19gh4uMWFRFVko5dmxihXhshoV5KzFKW3SpsLzI1LSnv62niZmlpIGEgWJdAODT1My+v7Wut9e7wMKLgpaNj5eZknFmTlhOPVM/NYFpZUJDQSAgKnaBmqG3zKiQfndqX25ydoZxb4NnYarZcotRCxcTAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/63ff4d88c94d08dd3e12a0879be33dc8/ba381/6play.webp 200w,\n/static/63ff4d88c94d08dd3e12a0879be33dc8/7f61c/6play.webp 400w,\n/static/63ff4d88c94d08dd3e12a0879be33dc8/d00b9/6play.webp 800w,\n/static/63ff4d88c94d08dd3e12a0879be33dc8/a9a89/6play.webp 1024w\"\n          sizes=\"(max-width: 800px) 100vw, 800px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/63ff4d88c94d08dd3e12a0879be33dc8/772e8/6play.png 200w,\n/static/63ff4d88c94d08dd3e12a0879be33dc8/e17e5/6play.png 400w,\n/static/63ff4d88c94d08dd3e12a0879be33dc8/5a190/6play.png 800w,\n/static/63ff4d88c94d08dd3e12a0879be33dc8/2bef9/6play.png 1024w\"\n          sizes=\"(max-width: 800px) 100vw, 800px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/63ff4d88c94d08dd3e12a0879be33dc8/5a190/6play.png\"\n          alt=\"6play\"\n          title=\"6play\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n    </span></p>\n<p>Since June 2017, I work with M6web team in Lyon (France) on the 6play platform. If you don’t know it, 6play is a french VOD service created for M6 group content replay. Based on React with SSR mode, this app is still evolving through years thanks to an amazing team. You can find more about what we are doing on the <a href=\"https://tech.m6web.fr/\">Tech M6Web blog</a>.</p>\n<p><strong>You will tell me, what is the relationship here with Webpack?</strong></p>\n<p>6play quickly used Webpack to pack code efficiently. Going from version to version (sometimes in tears and blood) we tried to configure our build to ensure a fast loading application.</p>\n<p>In 2018, 6play knew a big revolution, it became a white mark platform for other customers.</p>\n<p><a href=\"https://tech.m6web.fr/6play/6play-goes-international/\">The 6play platform goes international</a></p>\n<p>The big challenge for the front app was not only to create the translating part but also not to duplicate the code base. To be more precise, we only have one repository for all our customers (our name for a specific client app). The risk with this choice would have been to mix customer code into 6play code.</p>\n<p>Platforms looks very similar visually but under the hood hide many differences (ad engine, user tracking, and so on …). Just imagine the quantity of assets differences!</p>\n<p>We clearly wanted to avoid:</p>\n<ol>\n<li>Mixing customers code in bundles (JS and assets)</li>\n<li>Duplicating code</li>\n</ol>\n<p>That’s where Webpack became really useful.</p>\n<h4 id=\"customers-override\" style=\"position:relative;\"><a href=\"#customers-override\" aria-label=\"customers override permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>“Customers override”</h4>\n<p>In a white mark app, you often find the pattern of overriding a component or an asset to handle the difference in design you want to introduce. This overloading has been implemented foolishly this way for every module we want to override.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">...somewhere in our directory structure\n/customer/\n a/\n MyComponent.js\n b/\n MyComponent.js\n c/\n MyComponent.js\nRootMyComponent.js</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> Component <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./customer/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">CUSTOMER_CODE</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/MyComponent.js</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Component</code></pre></div>\n<p>This code works well for the customer overriding part but it has major issues. Issues that are not only due to the noise in our code structure but also by this heavy directory structure.</p>\n<h4 id=\"the-dynamic-require-trap\" style=\"position:relative;\"><a href=\"#the-dynamic-require-trap\" aria-label=\"the dynamic require trap permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The dynamic require trap</h4>\n<p>To understand the Big issue, we have to focus on this specific part.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./customer/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">CUSTOMER_CODE</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/MyComponent.js</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>I said before that Wepack is packing our module based on the dependency graph it is building. Here, the dependency is dynamic. So it does not know which module he will have to load. To avoid forgetting one, it will load all the modules that match the pattern below in his <strong><em>Context</em></strong>.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/^\\.\\/customer\\/.\\*\\/MyComponent\\.js</code></pre></div>\n<p>It means that all the different variants will be present in the resulting bundle. That’s exactly what we wanted to avoid.</p>\n<p><img src=\"/f05f9f86a9b4c71d3649659c3d154b88/whoops.gif\" alt=\"Whoups\"></p>\n<h4 id=\"contextreplacementplugin-trick\" style=\"position:relative;\"><a href=\"#contextreplacementplugin-trick\" aria-label=\"contextreplacementplugin trick permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ContextReplacementPlugin trick</h4>\n<p>You have probably already heard about the Webpack <em>context</em>. This famous time where you wanted to get rid of all the <a href=\"https://momentjs.com/\">moment</a> locales you do not need.</p>\n<p>If you don’t know it, MomentJS (the time most used JS lib) is loading all the locals by default with a dynamic require like you just saw.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpklEQVQY0x2NXWvTUACG8/dE3MWYCDJxgqKgF8J0MESnTlDZ1KqUjemY4qDOrsHkJG2aubZLKU0zk3N6cvJ5TpraGJJuF+o/MAoPD+/Nw8tlAT+l4jQU838IeSin9PA01v6k/Zg0QrNyyqScgikFJxTEx+VIL40Grwti4y2XUzlnjYzKWShlRc8OJsxMmPn7JPyVkTHey/z91Kum7l7qVBx1cSjfwPWbhYvNpewood1J8C3xlcQVE0/x7Z6pKy7qZCM9MjbtzrrdfgabK1BdgcI8rM0i/nzhobjAJcHBz7A9cRtjAuJhbQQ/M3M3MHZ8fcvpvvF6JUdbd7Xn9uFDt7ParVwUymfAxjlp42z/y2UusgHDckzEMa4xqyg/BYNtr7/p98uO9pIcrVnNx5bywAB3LWVZr86r2zOtD7Pq+xm9usCNsMCQ8APzkVWJzN3I/EiNd0Qr+b1XjraGW09I6xFW71n1O8fSIvx6CfJzkL9g1eaG4ArH4H5oVmP0/9PYCQZbXq9MtKJ8Ybef2q1VpN5HzWWsLn2vL+H6LQSuIek6AldJ8/ZfuzozkIisW+0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/54cd04b849073398ea42e804fff6e833/ba381/great-moment.webp 200w,\n/static/54cd04b849073398ea42e804fff6e833/7f61c/great-moment.webp 400w,\n/static/54cd04b849073398ea42e804fff6e833/d00b9/great-moment.webp 800w,\n/static/54cd04b849073398ea42e804fff6e833/a9a89/great-moment.webp 1024w\"\n          sizes=\"(max-width: 800px) 100vw, 800px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/54cd04b849073398ea42e804fff6e833/772e8/great-moment.png 200w,\n/static/54cd04b849073398ea42e804fff6e833/e17e5/great-moment.png 400w,\n/static/54cd04b849073398ea42e804fff6e833/5a190/great-moment.png 800w,\n/static/54cd04b849073398ea42e804fff6e833/2bef9/great-moment.png 1024w\"\n          sizes=\"(max-width: 800px) 100vw, 800px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/54cd04b849073398ea42e804fff6e833/5a190/great-moment.png\"\n          alt=\"Pretty heavy isn’t it ? (generated with webpack-bundle-analyser)\"\n          title=\"Pretty heavy isn’t it ? (generated with webpack-bundle-analyser)\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n    </span></p>\n<p>The common solution you will see in Github issue/StackOverflow will look like this one:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> webpackConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">webpack<span class=\"token punctuation\">.</span>ContextReplacementPlugin</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">moment[/\\\\]locale$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">fr</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This simple trick is essential to understand what is coming. Here, we are using a core Webpack plugin that magically reduces our bundle size. But what is it doing ?</p>\n<p>ContextReplacementPlugin will act like a hook triggered after Webpack failed to resolve modules for all the files in the context. It will just keep in the bundle all the Context files matching the first Regex and the second.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/moment/locale/fr.js // will stay\n\n/moment/locale/en.js // will be removed</code></pre></div>\n<p>If you are curious this <a href=\"https://github.com/webpack/webpack/blob/master/lib/ContextReplacementPlugin.js\">plugin’s code</a> is pretty simple.</p>\n<p><img src=\"/1d21777f357904ce76e6afd9bf301249/joy.gif\" alt=\"joy\"></p>\n<p>Nice, now we just have to use this plugin and select only the files matching the current customer code !!</p>\n<p>… Sadly that is still not good enough.</p>\n<p>The part we missed is the fact that we have to define the same component for each customer…each time. That’s pretty verbose No ?</p>\n<p>Of course it is !</p>\n<p><img src=\"/c637b5249b1034376426e3c0a96a9e88/adventure.gif\" alt=\"The journey really became an adventure\"></p>\n<p><strong>Our hand made CustomerReplacementPlugin</strong></p>\n<p>We have many cases where we just want to override a part of the application just for one customer. So the target structure to avoid duplication looks more like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">...somewhere in our directory structure\n/customer/\n default/\n MyComponent.js\n b/\n MyComponent.js\nRootMyComponent.js</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> Component <span class=\"token keyword\">from</span> <span class=\"token string\">'./customer/default/MyComponent.js'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Component</code></pre></div>\n<p>Ok now, there is no duplication left, but the ContextReplacementPlugin doesn’t seem to do the job here. Fortunately another plugin made it: <strong>NormalReplacementPlugin.</strong></p>\n<p>In the target structure above, there is no <code class=\"language-text\">require</code> left. Customer override won’t be loaded in the Context. Happily <strong>NormalReplacementPlugin</strong> will be our savior here.</p>\n<p>It really looks like the other plugin but this time the plugin can affect modules that have been normally resolved by Webpack and change their path just before the packing.</p>\n<p>So based on NormalReplacementPlugin implementation, I built a CustomerReplacementPlugin to do the trick (with a really foolish implementation for now)</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomerReplacementPlugin</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// To pass the current customer</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">customerName</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>customerName <span class=\"token operator\">=</span> customerName\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">compiler</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    compiler<span class=\"token punctuation\">.</span>hooks<span class=\"token punctuation\">.</span>normalModuleFactory<span class=\"token punctuation\">.</span><span class=\"token function\">tap</span><span class=\"token punctuation\">(</span><span class=\"token string\">'CustomerReplacementPlugin'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">nmf</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// just before thos normal modules have be resolved</span>\n      nmf<span class=\"token punctuation\">.</span>hooks<span class=\"token punctuation\">.</span>afterResolve<span class=\"token punctuation\">.</span><span class=\"token function\">tap</span><span class=\"token punctuation\">(</span><span class=\"token string\">'CustomerReplacementPlugin'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">result</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>result<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n\n        <span class=\"token comment\">// if the variant exists for the current customer</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">customer\\/default</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>resource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> customerResource <span class=\"token operator\">=</span> result<span class=\"token punctuation\">.</span>resource<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>\n            <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\/default\\/</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>customerName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token template-punctuation string\">`</span></span>\n          <span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">existsSync</span><span class=\"token punctuation\">(</span>customerResource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// I replace the resolved path by the customer path</span>\n            result<span class=\"token punctuation\">.</span>resource <span class=\"token operator\">=</span> customerResource\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> result\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nmodule<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">.</span>CustomerReplacementPlugin <span class=\"token operator\">=</span> CustomerReplacementPlugin</code></pre></div>\n<p>I hope this solution will at least help you understand those plugins or even help you enhance your application performances.</p>\n<h3 id=\"some-tips-i-found-useful-when-using-webpack\" style=\"position:relative;\"><a href=\"#some-tips-i-found-useful-when-using-webpack\" aria-label=\"some tips i found useful when using webpack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Some tips I found useful when using Webpack</h3>\n<p>This long article is still not finished. I still have some tips for you about Webpack. In recent years I have gathered some good practices to guarantee performances of your applications when using Webpack. Here is a non-exhaustive list.</p>\n<h4 id=\"know-your-weakness\" style=\"position:relative;\"><a href=\"#know-your-weakness\" aria-label=\"know your weakness permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Know your weakness</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 568px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEEA//EABYBAQEBAAAAAAAAAAAAAAAAAAMBAv/aAAwDAQACEAMQAAABjrTJdiczf//EABoQAQADAAMAAAAAAAAAAAAAAAIAAQMSEyH/2gAIAQEAAQUCz0cT4vxQgmukS8zU/8QAFhEBAQEAAAAAAAAAAAAAAAAAABIB/9oACAEDAQE/Aaxb/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAESE//aAAgBAgEBPwGss3//xAAdEAACAgEFAAAAAAAAAAAAAAAAAREhIjEyQaHh/9oACAEBAAY/AqdI3YwTMDSXJp2en//EABwQAQADAQADAQAAAAAAAAAAAAEAETEhQVGBsf/aAAgBAQABPyHEl3aMlM7Iit0t6Lh0cfkFOpo8qYFn1P/aAAwDAQACAAMAAAAQ2w//xAAYEQEAAwEAAAAAAAAAAAAAAAABABEhUf/aAAgBAwEBPxAA02V5P//EABgRAQADAQAAAAAAAAAAAAAAAAEAESFR/9oACAECAQE/EFHHJbs//8QAHRABAAMAAgMBAAAAAAAAAAAAAQARIUFxMVFhkf/aAAgBAQABPxB1bkr4fOpKsqIFMeG63Z1SBfp9ykCwVVLGm/WGgzARVOcymCSW0HPc/9k='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/b5f835a6fc15e0ecb1dc17dcd908d8a5/ba381/one-does-not-simply.webp 200w,\n/static/b5f835a6fc15e0ecb1dc17dcd908d8a5/7f61c/one-does-not-simply.webp 400w,\n/static/b5f835a6fc15e0ecb1dc17dcd908d8a5/bebff/one-does-not-simply.webp 568w\"\n          sizes=\"(max-width: 568px) 100vw, 568px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/b5f835a6fc15e0ecb1dc17dcd908d8a5/e07e9/one-does-not-simply.jpg 200w,\n/static/b5f835a6fc15e0ecb1dc17dcd908d8a5/066f9/one-does-not-simply.jpg 400w,\n/static/b5f835a6fc15e0ecb1dc17dcd908d8a5/94a05/one-does-not-simply.jpg 568w\"\n          sizes=\"(max-width: 568px) 100vw, 568px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/b5f835a6fc15e0ecb1dc17dcd908d8a5/94a05/one-does-not-simply.jpg\"\n          alt=\"one does not simply\"\n          title=\"one does not simply\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n    </span></p>\n<p>You have to check your bundle size regularly, if possible, even in your build chain. At @M6web , we developed our own tool to check that on each new development.</p>\n<ul>\n<li>It warns you if your bundles suddenly became too fat</li>\n<li>It compliments you when you make a bundle thinner</li>\n</ul>\n<p>Coupled with <a href=\"https://www.npmjs.com/package/webpack-bundle-analyzer\">Webpack Bundle Analyser</a>, you should be able to reduce your bundle drastically and thus improve your app performances.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 92%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB90lEQVQ4y4VTB47bMBD0/38UIO1yyTMc4Gw1FpEUe5UysnFBEMvJgpAtUcMpuzqV0i4d9y5NE2ez4EJyoRiXWFyqEPPj8iEtxqVSTrU1axIJ7KI6q51Ui1r0ok3KOeVSav1z1druK+837bRu67ZtNNAzOXvjffDWWu/99r9a1/V0/8EJlLCJED7PMSW1gFsLIbQ2UkohpIIeYw7AKKhg89z1Yz+MeM86B9nOR5iahQROqAWHHoNzLl0/nX++XbvBugA4UjHWp1wp47NYKJfOh2Nwa82HCLchRmQAEuwhE2zhCYLDLlQce0bFGIdxussGDP8hHik47xlj2po3ck0pH3ouIyGXa9/1g3HehQCt0DnPEv1cFmOSe6Hft7bdu/N3YJTPw0QQTG0rHC8G3qO2LgKsrY7uM3l5CiaUQzOasoOdR8Zg3kPOWS1GR/uFvK6760dwKeO0ywYe6aI3nAtMDMTnndnYf8kuZaKsG6e366Ag0jrKxY1fIet35m/bMXOtGIaJMNi+mY34SHwIjItcqzEOgX2iX2+8D2Bomwi9dj2cY+jBuY+jdXyWu2elwQzZTz2D9oL5JFRhiK3bochcW5wllV6CeWU/nqY9EjZSBgz6jFYBe29VuoFVMB+mj8dgjGe81e9baME154yXCthbZYnv0Pdqbf0F/jcOHbyc8NwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/bdd390b261c101672ff9a1f5b572ab7b/ba381/bundle-bot.webp 200w,\n/static/bdd390b261c101672ff9a1f5b572ab7b/7f61c/bundle-bot.webp 400w,\n/static/bdd390b261c101672ff9a1f5b572ab7b/d00b9/bundle-bot.webp 800w,\n/static/bdd390b261c101672ff9a1f5b572ab7b/90602/bundle-bot.webp 813w\"\n          sizes=\"(max-width: 800px) 100vw, 800px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/bdd390b261c101672ff9a1f5b572ab7b/772e8/bundle-bot.png 200w,\n/static/bdd390b261c101672ff9a1f5b572ab7b/e17e5/bundle-bot.png 400w,\n/static/bdd390b261c101672ff9a1f5b572ab7b/5a190/bundle-bot.png 800w,\n/static/bdd390b261c101672ff9a1f5b572ab7b/baaa6/bundle-bot.png 813w\"\n          sizes=\"(max-width: 800px) 100vw, 800px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/bdd390b261c101672ff9a1f5b572ab7b/5a190/bundle-bot.png\"\n          alt=\"6play bot\"\n          title=\"6play bot\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n    </span></p>\n<p>Unfortunately this tool is not yet ready to be open sourced. However, there are similar tools like this.</p>\n<p><a href=\"https://github.com/paularmstrong/build-tracker\">https://github.com/paularmstrong/build-tracker</a></p>\n<h4 id=\"es2015-bundles\" style=\"position:relative;\"><a href=\"#es2015-bundles\" aria-label=\"es2015 bundles permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ES2015+ bundles</h4>\n<p>You must know that some of our browsers can now use much more recent Javascript. Why then should we target only ES5?</p>\n<p>That’s why for the past few months we have been generating two versions of our bundles with two different <em>babel</em> targets on 6play.</p>\n<p>You should do the same and it is not <a href=\"http://twitter.com/AddyOsmani\">@AddyOsman</a>i that will contradict me.</p>\n<blockquote class=\"twitter-tweet\"><p lang=\"en\" dir=\"ltr\">JavaScript Tip: Serve smaller ES2015+ bundles to modern browsers &amp; transpiled ES5 to older ones with <a href=\"https://twitter.com/babeljs?ref_src=twsrc%5Etfw\">@babeljs</a> and preset-env:<a href=\"https://t.co/5FN7h23gow\">https://t.co/5FN7h23gow</a> <a href=\"https://t.co/wEq9xAFf3G\">https://t.co/wEq9xAFf3G</a><a href=\"https://t.co/fC1H9Grw6H\">https://t.co/fC1H9Grw6H</a> <a href=\"https://t.co/8Fez6dzsPf\">pic.twitter.com/8Fez6dzsPf</a></p>&mdash; Addy Osmani (@addyosmani) <a href=\"https://twitter.com/addyosmani/status/1082902291328360448?ref_src=twsrc%5Etfw\">January 9, 2019</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n<h3 id=\"compress-your-bundle-with-webpack\" style=\"position:relative;\"><a href=\"#compress-your-bundle-with-webpack\" aria-label=\"compress your bundle with webpack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Compress your bundle with Webpack</h3>\n<p>Few months ago, I gave <a href=\"https://docs.google.com/presentation/d/17w__X9JKrdlqZdSgIXfvlP2-TitxVCuYnkNBAZztSPk/edit?usp=sharing\">a talk at @LyonJS about compression in web</a>. I won’t explain why it’s required to deliver your file compressed, but you have to know that Webpack could do the job for you with Gzip.</p>\n<p><a href=\"https://github.com/webpack-contrib/compression-webpack-plugin\">https://github.com/webpack-contrib/compression-webpack-plugin</a></p>\n<p>And soon with <a href=\"https://github.com/google/brotli\">Brotli</a>, thanks to this pull request.</p>\n<p><a href=\"https://github.com/nodejs/node/pull/24938\">zlib: add Brotli support by addaleax · Pull Request #24938 · nodejs/node</a></p>\n<h3 id=\"to-go-even-further\" style=\"position:relative;\"><a href=\"#to-go-even-further\" aria-label=\"to go even further permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>To go even further</h3>\n<ul>\n<li><a href=\"https://github.com/webpack/webpack/issues/8537\">Webpack 5 is coming !</a></li>\n<li><a href=\"https://webpack.js.org/guides/\">Webpack official guide</a></li>\n<li><a href=\"https://jlongster.com/Backend-Apps-with-Webpack--Part-I\">Server side Webpack</a></li>\n<li><a href=\"https://webpack.js.org/guides/hot-module-replacement/\">Dev server with Webpack</a></li>\n<li>Follow <a href=\"https://medium.com/u/cccc522e775a\">Tobias Koppers</a>, <a href=\"https://medium.com/u/393110b0b9e4\">Sean T. Larkin</a> and <a href=\"https://medium.com/u/2508e4c7a8ec\">Addy Osmani</a> on twitter :)</li>\n</ul>\n<p><img src=\"/3aef3aa2b64eda8b17046625d2ae90ce/it-is-done.gif\" alt=\"it is done\"></p>","headings":[{"value":"Webpack : an unexpected journey"},{"value":"What is Webpack ?"},{"value":"Why is it often considered as a burden in the project ?"},{"value":"Unreachable best practices"},{"value":"The multiple environnement trap"},{"value":"Light of Eärendil"},{"value":"Why Webpack is a great tool for making your web app performant ?"},{"value":"Code splitting"},{"value":"Tree shaking"},{"value":"Case study: 6play a white mark VOD platform"},{"value":"“Customers override”"},{"value":"The dynamic require trap"},{"value":"ContextReplacementPlugin trick"},{"value":"Some tips I found useful when using Webpack"},{"value":"Know your weakness"},{"value":"ES2015+ bundles"},{"value":"Compress your bundle with Webpack"},{"value":"To go even further"}],"wordCount":{"words":2226},"tableOfContents":"<ul>\n<li><a href=\"/webpack-an-unexpected-journey/#webpack--an-unexpected-journey\">Webpack : an unexpected journey</a></li>\n<li><a href=\"/webpack-an-unexpected-journey/#what-is-webpack-\">What is Webpack ?</a></li>\n<li>\n<p><a href=\"/webpack-an-unexpected-journey/#why-is-it-often-considered-as-a-burden-in-the-project-\">Why is it often considered as a burden in the project ?</a></p>\n<ul>\n<li><a href=\"/webpack-an-unexpected-journey/#unreachable-best-practices\">Unreachable best practices</a></li>\n<li><a href=\"/webpack-an-unexpected-journey/#the-multiple-environnement-trap\">The multiple environnement trap</a></li>\n<li><a href=\"/webpack-an-unexpected-journey/#light-of-e%C3%A4rendil\"><em>Light of Eärendil</em></a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/webpack-an-unexpected-journey/#why-webpack-is-a-great-tool-for-making-your-web-app-performant-\">Why Webpack is a great tool for making your web app performant ?</a></p>\n<ul>\n<li><a href=\"/webpack-an-unexpected-journey/#code-splitting\">Code splitting</a></li>\n<li><a href=\"/webpack-an-unexpected-journey/#tree-shaking\">Tree shaking</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/webpack-an-unexpected-journey/#case-study-6play-a-white-mark-vod-platform\">Case study: 6play a white mark VOD platform</a></p>\n<ul>\n<li><a href=\"/webpack-an-unexpected-journey/#customers-override\">“Customers override”</a></li>\n<li><a href=\"/webpack-an-unexpected-journey/#the-dynamic-require-trap\">The dynamic require trap</a></li>\n<li><a href=\"/webpack-an-unexpected-journey/#contextreplacementplugin-trick\">ContextReplacementPlugin trick</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/webpack-an-unexpected-journey/#some-tips-i-found-useful-when-using-webpack\">Some tips I found useful when using Webpack</a></p>\n<ul>\n<li><a href=\"/webpack-an-unexpected-journey/#know-your-weakness\">Know your weakness</a></li>\n<li><a href=\"/webpack-an-unexpected-journey/#es2015-bundles\">ES2015+ bundles</a></li>\n</ul>\n</li>\n<li><a href=\"/webpack-an-unexpected-journey/#compress-your-bundle-with-webpack\">Compress your bundle with Webpack</a></li>\n<li><a href=\"/webpack-an-unexpected-journey/#to-go-even-further\">To go even further</a></li>\n</ul>","frontmatter":{"title":"Webpack : an unexpected journey","date":"January 18, 2019","dateJson":"2019-01-18","translations":null,"description":"Narration of my discover of webpack insideouts based of the hobbit path.","language":"en","tags":["webpack","learn"],"hero":{"childImageSharp":{"fluid":{"aspectRatio":2.4038461538461537,"src":"/static/49084b947bd8697a2f3cf8f67791611b/a7715/goingonanadventure1.jpg","srcSet":"/static/49084b947bd8697a2f3cf8f67791611b/8f7df/goingonanadventure1.jpg 250w,\n/static/49084b947bd8697a2f3cf8f67791611b/0f3a1/goingonanadventure1.jpg 500w,\n/static/49084b947bd8697a2f3cf8f67791611b/a7715/goingonanadventure1.jpg 1000w,\n/static/49084b947bd8697a2f3cf8f67791611b/f2e3f/goingonanadventure1.jpg 1400w","srcWebp":"/static/49084b947bd8697a2f3cf8f67791611b/e30b5/goingonanadventure1.webp","srcSetWebp":"/static/49084b947bd8697a2f3cf8f67791611b/7ca0e/goingonanadventure1.webp 250w,\n/static/49084b947bd8697a2f3cf8f67791611b/e9589/goingonanadventure1.webp 500w,\n/static/49084b947bd8697a2f3cf8f67791611b/e30b5/goingonanadventure1.webp 1000w,\n/static/49084b947bd8697a2f3cf8f67791611b/9592d/goingonanadventure1.webp 1400w","sizes":"(max-width: 1000px) 100vw, 1000px"},"image":{"src":"/static/49084b947bd8697a2f3cf8f67791611b/10d63/goingonanadventure1.jpg"},"image16x9":{"src":"/static/49084b947bd8697a2f3cf8f67791611b/6edcc/goingonanadventure1.jpg"},"image4x3":{"src":"/static/49084b947bd8697a2f3cf8f67791611b/e14ae/goingonanadventure1.jpg"},"image1x1":{"src":"/static/49084b947bd8697a2f3cf8f67791611b/db124/goingonanadventure1.jpg"}}}}},"relatedPosts":{"edges":[{"node":{"excerpt":"How did I cut in half my project’s webpack build time ? Who never complained about the infinite duration of a webpack build on a project ?\nI…","fields":{"slug":"/hunting-webpack-performances/"},"timeToRead":6,"frontmatter":{"title":"How to boost the speed of your webpack build?","date":"March 01, 2020","dateJson":"2020-03-01","description":"A story of performance optimization and application of the Pareto principle to a webpack build that has become far too long.","tags":["webpack","webperf"]}}},{"node":{"excerpt":"If you need to use webpack for your project. You are very often forced by  who have done the Job for you. You don’t know what webpack is for…","fields":{"slug":"/learn-webpack/"},"timeToRead":1,"frontmatter":{"title":"Learning webpack Step By Step","date":"July 23, 2019","dateJson":"2019-07-23","description":"webpack bundler seems to feel really complicated to learn but it tend to be much more simpler now. I made up some workshops in order to learn concepts.","tags":["webpack","mooc","learn"]}}},{"node":{"excerpt":"As a part-time computer science teacher, I often give workshops to learn about computers and their tools.\nSeveral times I met teams that had…","fields":{"slug":"/git-kata/"},"timeToRead":1,"frontmatter":{"title":"Announcing Git Kata","date":"July 21, 2019","dateJson":"2019-07-21","description":"As a part-time computer science teacher, I often give workshops to learn about computers and their tools.","tags":["git","learn","kata"]}}},{"node":{"excerpt":"If you are using webpack as module bundler for your application, you probably are concerned by its own performance and loading time.\nYou may…","fields":{"slug":"/why-you-should-use-compression-webpack-plugin/"},"timeToRead":3,"frontmatter":{"title":"Why you should use Compression Webpack Plugin?","date":"April 02, 2019","dateJson":"2019-04-02","description":"If you are using webpack as module bundler for your application, you probably are concerned by its own performance and loading time. You may have used code splitting, tree shaking, uglifyfication but you may have forgot a very important step.","tags":["webpack","webperf","compression"]}}}]}},"pageContext":{"slug":"/webpack-an-unexpected-journey/","tags":["webpack","learn"],"language":"en","previous":{"fields":{"slug":"/angular-training/"},"frontmatter":{"title":"Angular basics","tags":["angular","training","learn"]}},"next":{"fields":{"slug":"/why-you-should-use-compression-webpack-plugin/"},"frontmatter":{"title":"Why you should use Compression Webpack Plugin?","tags":["webpack","webperf","compression"]}}}},"staticQueryHashes":["1264045386","1666466174","4061151221"]}