{"componentChunkName":"component---src-templates-blog-post-js","path":"/discover-jest-hidden-feature-automock/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://slashgear.github.io"}},"config":{"html":"<p>Written by <strong>Antoine Caron</strong> who lives and works in Lyon (France) building useful things at <a href=\"https://www.bedrockstreaming.com/\">Bedrock</a>.\nYou should follow him <a href=\"https://twitter.com/Slashgear_\">on Twitter</a>.\nTake a look at <a href=\"/friends-you-should-follow\">my friends websites</a>.\nYou could also <a href=\"/conferences\">take a look at the conferences I gave</a>.\nIf you want to see my professional background, <a href=\"/resume\">my resume is available here</a>.</p>","fields":{"slug":"/"},"frontmatter":{"title":"Antoine Caron","language":"en"}},"markdownRemark":{"id":"17970804-b9da-5042-bbb5-c900873c08be","excerpt":"The subject of this article will be about Jest and the mocks. I do not wish to advocate the use of “unit tests” here. Everyone is also free…","html":"<p>The subject of this article will be about Jest and the mocks. <strong>I do not wish to advocate the use of “unit tests” here. Everyone is also free to define what is for him/her what is unitary.</strong> I just want to show you how Jest manages its <em>mock</em> and how <em>automocking</em> could be useful to you on a daily basis. <strong>It is important to know the basics of jest in order to understand the purpose of this article.</strong></p>\n<h1 id=\"tldr\" style=\"position:relative;\"><a href=\"#tldr\" aria-label=\"tldr permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TL;DR</h1>\n<p>Jest <em>automock</em> is fast and will help you add test easily. Consider using <em>automock</em> when you always want to isolate your tests. This will simplify the use of mock by harmonizing the way they are created.</p>\n<h2 id=\"context\" style=\"position:relative;\"><a href=\"#context\" aria-label=\"context permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Context</h2>\n<p>For several years now, I have been working in contexts that allow time and encourage people to write tests. For more than two years now, I have been working in the technical teams of the M6 group.</p>\n<p>We are using two <em>“kind”</em> of tests for our web platform:</p>\n<ul>\n<li><strong>“Unit tests”</strong> with Jest and <em>automock</em>: To test our services and components in an isolated context. Each test will only focus on a specific module considering that all the others are mocked.</li>\n<li><strong>“Feature/Functional tests”</strong> with CucumberJS and WebdriverIo: To test the product’s functionality, using user actions in a semi-real context.</li>\n</ul>\n<p>The testing context is quite specific. You probably don’t have the same way of doing them. But this context explains a lot our interest in <em>automocking</em>. We do use <code class=\"language-text\">mocks</code> a lot, and <em>Jest</em> is automatically mocking things for us which is great.</p>\n<p>If you are interested in the subject of testing, I can recommend this great conference by Kent C. Dodds at the last Assert(JS).</p>\n<div class=\"gatsby-resp-iframe-wrapper\" style=\"padding-bottom: 56.25%; position: relative; height: 0; overflow: hidden; margin-bottom: 1.0725rem\" > <iframe src=\"https://www.youtube-nocookie.com/embed/Fha2bVoC8SE\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen=\"\" style=\" position: absolute; top: 0; left: 0; width: 100%; height: 100%; \"></iframe> </div>\n<p>If you have listened to Kent’s talk, he proposes to do mainly integration tests.</p>\n<p>However, by following the TDD principle, the tests are really a great development tool for me to structure my design and move forward step by step. I still have difficulty today in designing my development based on integration tests.</p>\n<p>Moreover, by using “unit tests”, I can more easily refactor my code and thus gain more flexibility on the implementation. In my use, an implementation change in a module will only impact the associated test, unless the contract is modified.</p>\n<h2 id=\"how-to-\" style=\"position:relative;\"><a href=\"#how-to-\" aria-label=\"how to  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to ?</h2>\n<p>To activate the <em>automock</em>, it’s very simple. Just define this in the <em>jest</em> configuration.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  automock<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now, all the <em>import</em> you do in your tests will automatically be mocked. Therefore, you will need <em>unmock</em> the module you want to test. With this technique, you no longer need to define 10 lines of <em>mock</em> at the beginning of your file.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> dependency <span class=\"token keyword\">from</span> <span class=\"token string\">'dependency'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> myMethod <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../module/foo.js'</span>\n\n<span class=\"token comment\">//the lines below are not necessary with automock activated</span>\njest<span class=\"token punctuation\">.</span><span class=\"token function\">mock</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../module/foo.js'</span><span class=\"token punctuation\">)</span>\njest<span class=\"token punctuation\">.</span><span class=\"token function\">mock</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dependency'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>In the case of a <em>React</em> component test, all the components on which you depend will be mocked. No more risk of breaking several test files when modifying a single component.</p>\n<p>When your module depends on <em>asynchronous functions</em>, you can easily stub their error or success behavior with <code class=\"language-text\">mockResolveValue</code> and <code class=\"language-text\">mockRejectValue</code>.</p>\n<h2 id=\"what-happens-when-you-call-jestmock-\" style=\"position:relative;\"><a href=\"#what-happens-when-you-call-jestmock-\" aria-label=\"what happens when you call jestmock  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What happens when you call <code class=\"language-text\">jest.mock</code> ?</h2>\n<p>Before explaining why I love using automock, let’s see what <em>Jest</em> does when he is asked to mock a module.</p>\n<p>When you use <code class=\"language-text\">jest.mock</code> on a module. Every exported values will be transformed like this (recursively):</p>\n<ul>\n<li><code class=\"language-text\">Function</code> will be transformed to <em>spy</em> function doing <code class=\"language-text\">noop</code> (like, the <code class=\"language-text\">jest.fn()</code>)</li>\n<li><code class=\"language-text\">Array</code> will be transformed to empty array.</li>\n<li><code class=\"language-text\">ES6 Class</code> will be transformed like function</li>\n<li><code class=\"language-text\">Number</code>, <code class=\"language-text\">Object</code>, <code class=\"language-text\">String</code> won’t be affected.</li>\n</ul>\n<p>To summarize, we can say that the default mock does what we would hope if we wanted to isolate our test from all existing modules.</p>\n<p><code class=\"language-text\">Automock</code> is working just like <code class=\"language-text\">jest.mock</code> but for all the imported module of your test. It’ll save you a lot of time.</p>\n<h1 id=\"what-is-great-with-automock-\" style=\"position:relative;\"><a href=\"#what-is-great-with-automock-\" aria-label=\"what is great with automock  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What is great with <em>automock</em> ?</h1>\n<p>For me, activating Jest’s automock means taking full advantage of jest’s ability to generate a mocked version of a module.</p>\n<p>No need to wonder if the module or dependency you are importing is mocked. Absolutely everything is mocked.</p>\n<p>The only “noise” in your test will be from <code class=\"language-text\">unmock</code> the file you want to test.</p>\n<p>Some may think that enabling this option will slow down your tests. Don’t worry about it. On the project I’m working on, we have more than 3000 tests that run in less than 4 minutes.</p>\n<h2 id=\"tips\" style=\"position:relative;\"><a href=\"#tips\" aria-label=\"tips permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tips</h2>\n<ul>\n<li>Switching to <code class=\"language-text\">automock</code> on a huge project with many tests will be hard and dangerous.</li>\n<li>When your test behave strangely, maybe you forgot to <code class=\"language-text\">unmock</code> the module your are testing. It’s going to drive you crazy.</li>\n<li>Try to outsource in <code class=\"language-text\">__mocks__</code> files as soon as you are forced to duplicate a mock.</li>\n<li>Don’t forget <code class=\"language-text\">jest</code> is auto mocking <code class=\"language-text\">Array</code> by an empty <code class=\"language-text\">Array</code>.</li>\n</ul>\n<p>If you liked this article, don’t hesitate to share it! If you do your tests differently, share your tips with us.</p>\n<p>Feel free to share your <em>tips</em> with Jest.</p>","headings":[{"value":"TL;DR"},{"value":"Context"},{"value":"How to ?"},{"value":"What happens when you call <code class=\"language-text\">jest.mock</code> ?"},{"value":"What is great with automock ?"},{"value":"Tips"}],"wordCount":{"words":772},"tableOfContents":"<ul>\n<li>\n<p><a href=\"/discover-jest-hidden-feature-automock/#tldr\">TL;DR</a></p>\n<ul>\n<li><a href=\"/discover-jest-hidden-feature-automock/#context\">Context</a></li>\n<li><a href=\"/discover-jest-hidden-feature-automock/#how-to-\">How to ?</a></li>\n<li><a href=\"/discover-jest-hidden-feature-automock/#what-happens-when-you-call-jestmock-\">What happens when you call <code class=\"language-text\">jest.mock</code> ?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/discover-jest-hidden-feature-automock/#what-is-great-with-automock-\">What is great with <em>automock</em> ?</a></p>\n<ul>\n<li><a href=\"/discover-jest-hidden-feature-automock/#tips\">Tips</a></li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"Discover Jest hidden feature: Automock","date":"July 29, 2019","dateJson":"2019-07-29","translations":null,"description":"Testing is quite complicated. Even for JS app, libraries. But Jest helps a lot.","language":"en","tags":["jest","test","mock"],"hero":{"childImageSharp":{"fluid":{"aspectRatio":1.7730496453900708,"src":"/static/b3e03a9d2101d16c4f17903e0fe731fd/a7715/jest.jpg","srcSet":"/static/b3e03a9d2101d16c4f17903e0fe731fd/8f7df/jest.jpg 250w,\n/static/b3e03a9d2101d16c4f17903e0fe731fd/0f3a1/jest.jpg 500w,\n/static/b3e03a9d2101d16c4f17903e0fe731fd/a7715/jest.jpg 1000w,\n/static/b3e03a9d2101d16c4f17903e0fe731fd/10d63/jest.jpg 1080w","srcWebp":"/static/b3e03a9d2101d16c4f17903e0fe731fd/e30b5/jest.webp","srcSetWebp":"/static/b3e03a9d2101d16c4f17903e0fe731fd/7ca0e/jest.webp 250w,\n/static/b3e03a9d2101d16c4f17903e0fe731fd/e9589/jest.webp 500w,\n/static/b3e03a9d2101d16c4f17903e0fe731fd/e30b5/jest.webp 1000w,\n/static/b3e03a9d2101d16c4f17903e0fe731fd/54d25/jest.webp 1080w","sizes":"(max-width: 1000px) 100vw, 1000px"},"image":{"src":"/static/b3e03a9d2101d16c4f17903e0fe731fd/10d63/jest.jpg"},"image16x9":{"src":"/static/b3e03a9d2101d16c4f17903e0fe731fd/6edcc/jest.jpg"},"image4x3":{"src":"/static/b3e03a9d2101d16c4f17903e0fe731fd/e14ae/jest.jpg"},"image1x1":{"src":"/static/b3e03a9d2101d16c4f17903e0fe731fd/db124/jest.jpg"}}}}},"relatedPosts":{"edges":[]}},"pageContext":{"slug":"/discover-jest-hidden-feature-automock/","tags":["jest","test","mock"],"language":"en","previous":{"fields":{"slug":"/git-tip-why-you-should-not-keep-a-local-master-branch/"},"frontmatter":{"title":"Git TIP -  Why you should not keep a local master branch ?","tags":["git"]}},"next":{"fields":{"slug":"/optional-chaining-trap/"},"frontmatter":{"title":"😰 Optional chaining trap !","tags":["js","babel"]}}}},"staticQueryHashes":["1264045386","1666466174","4061151221","62118570"]}