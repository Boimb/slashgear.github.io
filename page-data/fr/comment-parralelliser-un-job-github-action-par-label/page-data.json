{"componentChunkName":"component---src-templates-blog-post-js","path":"/fr/comment-parralelliser-un-job-github-action-par-label/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://slashgear.github.io"}},"config":{"html":"<p>Ecrit par <strong>Antoine Caron</strong> qui vit et travaille à Lyon et développe des choses utiles à <a href=\"https://www.bedrockstreaming.com/\">Bedrock</a>.\nTu devrais le suivre sur <a href=\"https://twitter.com/Slashgear_\">Twitter</a></p>","fields":{"slug":"/fr/"},"frontmatter":{"title":"Antoine Caron","language":"fr"}},"markdownRemark":{"id":"3afb3631-ad55-5560-b8d9-c51b101ce935","excerpt":"Depuis quelque temps, je joue avec les actions github pour voir si je peux facilement reproduire les comportements que j’applique dans mon…","html":"<p>Depuis quelque temps, je joue avec les actions github pour voir si je peux facilement reproduire les comportements que j’applique dans mon outil de CI actuel.\nJe voulais mettre en parallèle des jobs en me basant sur les labels associés à une Pull Request.\nDans cet article, je vais vous montrer une façon possible de le faire ! (N’ayant pas trouvé d’article sur internet expliquant comment le faire)</p>\n<p>Dans mon travail à <a href=\"https://www.bedrockstreaming.com/\">Bedrock</a>, nous utilisons actuellement Jenkins pour gérer l’intégration et le déploiement de nos applications.\nAu-delà de la galère liée à l’utilisation de groovy avec la syntaxe de pipeline 😅, nous devons admettre que nous parvenons à réaliser des workflow assez complexes.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/19010545e7456d3a5201b61a03e8a4ad/ddced/ci.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 194.00000000000003%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAnABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAIDAQX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB96LzjUUz0gsHYCgf/8QAFhABAQEAAAAAAAAAAAAAAAAAARAg/9oACAEBAAEFAmuGtZ//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AV//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AV//xAAUEAEAAAAAAAAAAAAAAAAAAAAw/9oACAEBAAY/An//xAAYEAACAwAAAAAAAAAAAAAAAAAQMQABEf/aAAgBAQABPyFJoSWWLGmof//aAAwDAQACAAMAAAAQu848c8//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EF//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EF//xAAcEAEAAgIDAQAAAAAAAAAAAAABADEQESFxgUH/2gAIAQEAAT8QGkinsV9V5hRLepb2FYv7hWLO4VjW4bdm8f/Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/19010545e7456d3a5201b61a03e8a4ad/ba381/ci.webp 200w,\n/static/19010545e7456d3a5201b61a03e8a4ad/7f61c/ci.webp 400w,\n/static/19010545e7456d3a5201b61a03e8a4ad/d00b9/ci.webp 800w,\n/static/19010545e7456d3a5201b61a03e8a4ad/abb12/ci.webp 1100w\"\n          sizes=\"(max-width: 800px) 100vw, 800px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/19010545e7456d3a5201b61a03e8a4ad/e07e9/ci.jpg 200w,\n/static/19010545e7456d3a5201b61a03e8a4ad/066f9/ci.jpg 400w,\n/static/19010545e7456d3a5201b61a03e8a4ad/4b190/ci.jpg 800w,\n/static/19010545e7456d3a5201b61a03e8a4ad/ddced/ci.jpg 1100w\"\n          sizes=\"(max-width: 800px) 100vw, 800px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/19010545e7456d3a5201b61a03e8a4ad/4b190/ci.jpg\"\n          alt=\"exemple de flux de travail complexe d&#39;intégration continue\"\n          title=\"exemple de flux de travail complexe d&#39;intégration continue\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>Décidant de voir s’il serait facile pour moi de reproduire les étapes de ces pipelines avec les github actions, j’ai décidé d’essayer ses fonctionnalités.\nEntre autres en publiant <a href=\"https://github.com/Slashgear/action-check-pr-title\">une Github Action pour vérifier le titre d’un PR selon une regexp.</a></p>\n<h2 id=\"une-solution\" style=\"position:relative;\"><a href=\"#une-solution\" aria-label=\"une solution permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Une Solution</h2>\n<p>Vous devez d’abord créer un workflow basé sur des événements <code class=\"language-text\">pull_request</code> et vous pouvez même spécifier les types d’événements.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Example workflow\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">pull_request</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">types</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>opened<span class=\"token punctuation\">,</span> labeled<span class=\"token punctuation\">,</span> unlabeled<span class=\"token punctuation\">,</span> synchronize<span class=\"token punctuation\">]</span></code></pre></div>\n<p>Ajoutez maintenant un job qui mettra en place une stratégie de parallélisation basée sur les étiquettes de l’événement github.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">strategy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">matrix</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">label</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>github.event.pull_request.labels.<span class=\"token important\">*.name</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Run a one<span class=\"token punctuation\">-</span>line script\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> echo Hello<span class=\"token punctuation\">,</span> world from \"$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>matrix.label<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\"<span class=\"token tag\">!</span></code></pre></div>\n<p>Les étapes seront automatiquement exécutées en parallèle sur toutes les labels de chaque PR. 🎉\nCependant, <code class=\"language-text\">strategy.matrix.label</code> n’accepte pas un tableau vide comme valeur.😢</p>\n<p>Le job doit donc être conditionné pour n’être exécuté que si <code class=\"language-text\">${{github.event.pull_request.labels.*.name}}</code> n’est pas vide.\nIl y a un paramètre <code class=\"language-text\">if</code> dans les jobs qui permet de faire cela, mais malheureusement il est interprété après avoir vérifié la valeur de <code class=\"language-text\">strategy.matrix.label</code>.</p>\n<p>La solution que j’ai trouvée est de faire cette vérification dans un job précédent.\nVoici un exemple de workflow qui lance dynamiquement des actions sur toutes les étiquettes de chaque RP.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Example workflow\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">pull_request</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">types</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>opened<span class=\"token punctuation\">,</span> labeled<span class=\"token punctuation\">,</span> unlabeled<span class=\"token punctuation\">,</span> synchronize<span class=\"token punctuation\">]</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">checkLabels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>github.event.pull_request.labels.<span class=\"token important\">*.name</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> echo Check labels is not empty\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">needs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>checkLabels<span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">strategy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">matrix</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">label</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>github.event.pull_request.labels.<span class=\"token important\">*.name</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Run a one<span class=\"token punctuation\">-</span>line script\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> echo Hello<span class=\"token punctuation\">,</span> world from \"$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>matrix.label<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\"<span class=\"token tag\">!</span></code></pre></div>\n<p>À vous de l’adapter à vos besoins !</p>","headings":[{"value":"Une Solution"}],"wordCount":{"words":296},"tableOfContents":"<ul>\n<li><a href=\"/fr/comment-parralelliser-un-job-github-action-par-label/#une-solution\">Une Solution</a></li>\n</ul>","frontmatter":{"title":"Github Action : Comment gérer dynamiquement des steps pour chaque label de Pull Request ?","date":"November 29, 2020","dateJson":"2020-11-29","translations":["en","how-to-dynamically-run-step-on-each-github-pr-label"],"description":"Depuis quelque temps, je joue avec les actions github pour voir si je peux facilement reproduire les comportements que j'applique dans mon outil de CI actuel. Je voulais mettre en parallèle les tâches sur chaque label de Pull Request.","language":"fr","tags":["github","action","CI","tutoriel"],"hero":{"childImageSharp":{"fluid":{"aspectRatio":1.9083969465648856,"src":"/static/ff44249e8985e61cdbe670afb0139b18/a7715/github-actions.jpg","srcSet":"/static/ff44249e8985e61cdbe670afb0139b18/8f7df/github-actions.jpg 250w,\n/static/ff44249e8985e61cdbe670afb0139b18/0f3a1/github-actions.jpg 500w,\n/static/ff44249e8985e61cdbe670afb0139b18/a7715/github-actions.jpg 1000w,\n/static/ff44249e8985e61cdbe670afb0139b18/47498/github-actions.jpg 1200w","srcWebp":"/static/ff44249e8985e61cdbe670afb0139b18/e30b5/github-actions.webp","srcSetWebp":"/static/ff44249e8985e61cdbe670afb0139b18/7ca0e/github-actions.webp 250w,\n/static/ff44249e8985e61cdbe670afb0139b18/e9589/github-actions.webp 500w,\n/static/ff44249e8985e61cdbe670afb0139b18/e30b5/github-actions.webp 1000w,\n/static/ff44249e8985e61cdbe670afb0139b18/99238/github-actions.webp 1200w","sizes":"(max-width: 1000px) 100vw, 1000px"},"image":{"src":"/static/ff44249e8985e61cdbe670afb0139b18/10d63/github-actions.jpg"},"image16x9":{"src":"/static/ff44249e8985e61cdbe670afb0139b18/6edcc/github-actions.jpg"},"image4x3":{"src":"/static/ff44249e8985e61cdbe670afb0139b18/e14ae/github-actions.jpg"},"image1x1":{"src":"/static/ff44249e8985e61cdbe670afb0139b18/db124/github-actions.jpg"}}}}},"relatedPosts":{"edges":[{"node":{"excerpt":"Encore une fois, je me suis donné un challenge pour apprendre à utiliser Github Action.\nJ’ai essayé de voir s’il était possible de lancer…","fields":{"slug":"/fr/comment-lancer-des-actions-github-en-simultane-sur-des-sous-dossiers/"},"timeToRead":1,"frontmatter":{"title":"Github Action : Comment paralléliser ses tests dynamiquement par dossier ?","date":"December 01, 2020","dateJson":"2020-12-01","description":"Encore une fois, je joue avec les Github Action pour voir si elles peuvent répondre aux problématiques de CI que je peux rencontrer dans mon travail.","tags":["github","action","CI","tutoriel"]}}},{"node":{"excerpt":"Github Pages est une solution pour héberger des sites web statiques directement dans ton dépôt Github en poussant les fichiers du site vers…","fields":{"slug":"/fr/comment-deployer-sur-github-pages-avec-travis-ci/"},"timeToRead":2,"frontmatter":{"title":"Comment se déployer sur les pages Github avec Travis CI ?","date":"May 26, 2020","dateJson":"2020-05-26","description":"Comment automatiser en quelques minutes le déploiement de votre site sur les pages Github avec l'outil Travis CI. Ce tutoriel décrit étape par étape toutes les actions à effectuer pour publier un site statique sur des pages Github et l'héberger gratuitement.","tags":["tutoriel","github","gatsby"]}}},{"node":{"excerpt":"Lorsque j’ai commencé à enseigner en septembre dernier, je recherchais une solution\npour pouvoir suivre facilement l’avancée des étudiants…","fields":{"slug":"/fr/github-classroom/"},"timeToRead":6,"frontmatter":{"title":"Github classroom - un outil à tester","date":"March 25, 2017","dateJson":"2017-03-25","description":"J'ai récemment essayé Github Classroom avec mes étudiants de 4ème année de l'école Polytech Lyon. Je vous propose ici mes retours sur cet outil à destination des enseignants pour le suivi de TP.","tags":["formation","git","github"]}}}]}},"pageContext":{"slug":"/fr/comment-parralelliser-un-job-github-action-par-label/","tags":["github","action","CI","tutoriel"],"language":"fr","previous":{"fields":{"slug":"/fr/les-conferences-tech-a-voir-et-a-revoir/"},"frontmatter":{"title":"Les conférences que je recommande à mes étudiants","tags":["conférence","étudiants","vidéo","tech"]}},"next":{"fields":{"slug":"/fr/comment-lancer-des-actions-github-en-simultane-sur-des-sous-dossiers/"},"frontmatter":{"title":"Github Action : Comment paralléliser ses tests dynamiquement par dossier ?","tags":["github","action","CI","tutoriel"]}}}},"staticQueryHashes":["1264045386","1666466174","4061151221"]}