{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/fr/comment-ne-pas-jeter-son-application-au-bout-de-deux-ans/",
    "result": {"data":{"site":{"siteMetadata":{"siteUrl":"https://blog.slashgear.dev"}},"config":{"html":"<p>Ecrit par <strong>Antoine Caron</strong> qui vit et travaille à Lyon et développe des choses utiles à <a href=\"https://www.bedrockstreaming.com/\">Bedrock</a>.\nTu devrais le suivre sur <a href=\"https://twitter.com/Slashgear_\">Twitter</a>.\nN’hésites pas à aller voir <a href=\"/conferences\">ses conférences sur la page dédiée</a>.\nSi vous voulez voir mon parcours pro, <a href=\"/resume\">mon CV est disponible ici en 🇬🇧</a>.</p>","fields":{"slug":"/fr/"},"frontmatter":{"title":"Antoine Caron","language":"fr"}},"markdownRemark":{"id":"c2d814a7-e9b0-50ba-9150-fb56e2168ed0","excerpt":"Comment ne pas jeter son application tous les deux ans ? Retour d’expérience basé sur les bonnes pratiques appliquées à la plateforme web…","html":"<blockquote>\n<p>Comment ne pas jeter son application tous les deux ans ?</p>\n</blockquote>\n<p><em>Retour d’expérience basé sur les bonnes pratiques appliquées à la plateforme web développée chez <a href=\"https://www.bedrockstreaming.com/\">Bedrock Streaming</a></em></p>\n<h2 id=\"un-peu-de-contexte\" style=\"position:relative;\"><a href=\"#un-peu-de-contexte\" aria-label=\"un peu de contexte permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Un peu de contexte</h2>\n<p>Chez Bedrock Streaming de nombreuses équipes développent et maintiennent des applications <em>frontend</em> pour nos clients et utilisateurs.\nCertaines ne sont pas toute jeune.\nEn effet, l’application sur laquelle je travaille principalement est un site web dont les développements ont commencé en 2014.\nJe l’ai d’ailleurs déjà évoquée dans différents articles de <a href=\"https://blog.slashgear.dev/\">ce blog</a>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 294px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/57c6ca4dcd6d3e2b9db0b2d28a14cd48/04a86/commit-count.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.500000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABB0lEQVQY03WRXU/CMBiF9/9/gtFE8QI1cd6AF0CiLCZzOCbLQjbAuEXiSNCpfIM6HvNuKVlIvHj6tqftaU+rTdYw+4bpBr5W2wzRVH+fz6WQ7si1dLdPk+b1fUaczDNTMZcFUuc/+UFSZbz4zVltYZnmyJxUdSFtOJ5wYzpYnYAgjCmd6dyabZqmw8FxmavrBiflS8I4oReN8AYvPHh9On5I92nI/aNPy+0xnqwzUy1OFtjegDvbIxp9UKk10St1qg2Do9ML9Gqdw9I5/nOM7fUxLDfDdLq4QYTRcqkZVrZXbquJq8RVkUV8m26y2BJPaSpS8QkUoql316TZ/5TigiL/fZboyvAPSmTAPpMq1MsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/57c6ca4dcd6d3e2b9db0b2d28a14cd48/ba381/commit-count.webp 200w,\n/static/57c6ca4dcd6d3e2b9db0b2d28a14cd48/456a1/commit-count.webp 294w\"\n              sizes=\"(max-width: 294px) 100vw, 294px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/57c6ca4dcd6d3e2b9db0b2d28a14cd48/772e8/commit-count.png 200w,\n/static/57c6ca4dcd6d3e2b9db0b2d28a14cd48/04a86/commit-count.png 294w\"\n            sizes=\"(max-width: 294px) 100vw, 294px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/57c6ca4dcd6d3e2b9db0b2d28a14cd48/04a86/commit-count.png\"\n            alt=\"impression d&#39;écran du nombre de commit sur master de notre projet 15668\"\n            title=\"impression d&#39;écran du nombre de commit sur master de notre projet 15668\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Vous pourriez vous dire: <em>“Oh les pauvres maintenir une application vieille de presque 10 ans ça doit être un enfer !”</em></p>\n<p>Rassurez-vous, ce n’est pas le cas !\nJ’ai travaillé sur des projets bien moins vieux mais sur lesquels le développement de nouvelles fonctionnalités était bien plus pénible.</p>\n<p>Aujourd’hui le projet reste à jour techniquement, on doit être sur la dernière version de React alors que celui-ci avait commencé sur une version <em>0.x.x</em>.\nDans ce monde des technologies web souvent décrié (ex: les nombreux articles sur la <em>Javascript Fatigue</em>) dont les outils et les pratiques évoluent constamment, conserver un projet “à jour” reste un vrai challenge.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 350px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/87ea590416839a8413c9d4905c0fa4b6/13ae7/releases.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA1klEQVQoz52RUUsCQRSF/fNC4JME/QARtQwNg6BX01xWZ3c2tNBCEOl5X3ScGdn9YheyTd0MD5x7hwvncOfcAkAcx2czq09Q+H5kkSc8hqxpapgUYyxKqXRgrM0Vam3QxmK3WzbapD1rtjP0ZEDxokT9ukn58opKtcbNbStltdagfddhtVYMheTp2eH+4ZFGs8Xb9P3wy0kJw5Dx5BVfBgjPZ+C4jISH50tGwkcGL6iNZvYxx3EFvYFLt++wWH7+L8PcvE7kuNswGURR9Cf3L/r7YD8bfgGItBhXwYwvkwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/87ea590416839a8413c9d4905c0fa4b6/ba381/releases.webp 200w,\n/static/87ea590416839a8413c9d4905c0fa4b6/a3432/releases.webp 350w\"\n              sizes=\"(max-width: 350px) 100vw, 350px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/87ea590416839a8413c9d4905c0fa4b6/772e8/releases.png 200w,\n/static/87ea590416839a8413c9d4905c0fa4b6/13ae7/releases.png 350w\"\n            sizes=\"(max-width: 350px) 100vw, 350px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/87ea590416839a8413c9d4905c0fa4b6/13ae7/releases.png\"\n            alt=\"nombre de versions de l&#39;application 1445\"\n            title=\"nombre de versions de l&#39;application 1445\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>De plus, dans le contexte de ce projet, en presque 10 ans, nous avons connu une centaine de contributeurs.\nCertains ne sont restés que quelques mois/années.\nComment garder au maximum la connaissance sur “Comment on fait les choses et comment ça marche ?” dans un contexte humain si mouvant ?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/333e464600eaed01c177c248b9aac0eb/1e043/contributors.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABxklEQVQoz5WSTWsTURSG55+5K4ILwZ3iopZ20Z1LXQmCX6BuVLB0BKlELAyFImprG0IpamqlpTrJtIn5mGQyITGT1KSZz9x5ZJJCk0I1Hjjcc7nwnuec+0qMEWEYMm5I7U4HNZVG0/bZ2d1DTWv8UFPUanVy+SIFvUSkJ8KQngj74qdzuKnkeR4Vs0rZqGAYZYxykXy+wFG3i142sKzmP8mHTykIAnRdB9HDaDh8L7n9R1VVCUPBdkrj884eDTvgXe43vohIxYAW6LruKKFpmsjyPKtr68SUFW7emSO+8Yn79+6S3PrKxJXLTExdY2F5jfOTs2yraYxWm9qRTU5Nsbm0RMe2TwijInuQoVjQOey0MKtZDlttXsVi9HohicQqG5txmvUGb148x2pafToBlLI/+fJhBcfzTgQtw2Lmwg0Wnq3z5ONjpp9Okzn4xq3JS8zJMsvv3/Lw0QN83x/LCVK9anHx3HUUOcHr5Etm5qfIZHa5PXuVRUUhuRVHWZSxHbe/UyHE6C8f30dGHvbZYJiR1v/lRynak97w2Tddir880oaLZjpUWn6fKDwWOm2RMwUjw7q+wPEFbiCwvUF6gTjTvH8T/AMwFjMwDY8xawAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/333e464600eaed01c177c248b9aac0eb/ba381/contributors.webp 200w,\n/static/333e464600eaed01c177c248b9aac0eb/7f61c/contributors.webp 400w,\n/static/333e464600eaed01c177c248b9aac0eb/8efd0/contributors.webp 690w\"\n              sizes=\"(max-width: 690px) 100vw, 690px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/333e464600eaed01c177c248b9aac0eb/772e8/contributors.png 200w,\n/static/333e464600eaed01c177c248b9aac0eb/e17e5/contributors.png 400w,\n/static/333e464600eaed01c177c248b9aac0eb/1e043/contributors.png 690w\"\n            sizes=\"(max-width: 690px) 100vw, 690px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/333e464600eaed01c177c248b9aac0eb/1e043/contributors.png\"\n            alt=\"liste des 100 contributeurs du projet\"\n            title=\"liste des 100 contributeurs du projet\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>C’est ce que je vous propose de vous présenter.</p>\n<p>Avec l’aide de mes collègues, j’ai rassemblé la liste des bonnes pratiques qui nous permettent encore aujourd’hui de maintenir ce projet en état.\nAvec <a href=\"https://twitter.com/fooragnak\">Florent Dubost</a>, on s’est souvent dit qu’il serait intéressant de la publier.\nNous espèrons que cela vous sera utile.</p>\n<h2 id=\"simposer-des-règles-et-les-automatiser\" style=\"position:relative;\"><a href=\"#simposer-des-r%C3%A8gles-et-les-automatiser\" aria-label=\"simposer des règles et les automatiser permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>S’imposer des règles et les automatiser</h2>\n<p>Un projet qui résiste au temps c’est tout d’abord un ensemble de connaissances qu’on empile les unes sur les autres.\nC’est en quelque sorte la tour de Kapla que vous assembliez petit en essayant d’aller le plus haut possible.\nUne base solide sur laquelle on espère pouvoir ajouter le plus possible avant une potentielle chute.</p>\n<p>Dès le début d’un projet on est donc amené à prendre des décisions importantes sur “Comment on souhaite faire les choses ?“.\nOn pense par exemple à “Quel format pour nos fichiers ? Comment on nomme telle ou telle chose ?”\nÉcrire une documentation précise de “Comment on fait les choses” pourrait paraitre une bonne idée.</p>\n<p>Cependant la documentation c’est cool, mais ça a tendance à périmer très vite.\nNos décisions évoluent mais pas la documentation.</p>\n<blockquote>\n<p>“Les temps changent mais pas les README.”</p>\n<p><a href=\"https://twitter.com/omansour\"><em>Olivier Mansour (deputy CTO à Bedrock)</em></a></p>\n</blockquote>\n<p>Automatiser la vérification de chacune des règles qu’on s’impose (sur notre codebase ou nos process) est bien plus pérenne.\nPour faire simple, on évite dans la mesure du possible de dire “On devrait faire les choses comme cela”, et on préfère “on va coder un truc qui nous le vérifie à notre place”.\nEn plus de ça, coté JS on est vraiment bien équipé avec des outils comme <a href=\"https://eslint.org/\">Eslint</a> qui nous permettent d’implémenter nos propres règles.</p>\n<p>Le réflexe qu’on essaie donc d’adopter est donc le suivant:</p>\n<ul>\n<li>“On devrait essayer de faire comme cela à présent !”</li>\n<li>“Ok c’est intéressant, mais comment peut-on s’assurer qu’on fasse comme cela automatiquement avec notre CI (Intégration continue) ?”</li>\n</ul>\n<p>L’intégration continue d’un projet est la solution parfaite pour ne rien louper sur chacune des <em>Pull Request</em> que nous proposons.\nLes reviews n’en sont que plus simples car vous n’avez plus à vous soucier de l’ensemble des règles qui sont déjà automatisées.\nDans ce modèle, la review sert donc plus au partage de connaissance qu’au flicage de typo et autre non respect des conventions du projet.</p>\n<p>Dans ce principe, il faut donc essayer de bannir les règles orales.\nLe temps des druides est terminé, s’il faut transmettre oralement toutes les bonnes pratiques d’un projet, l’accompagnement de nouveaux développeurs dans votre équipe n’en sera que plus long.</p>\n<p><img src=\"/c822e03ae4384a98d62f2bbf5cca0be9/panoramix.gif\" alt=\"la recette de la potion magique de panoramix est perdue car secrète\"></p>\n<p>Un projet n’est pas figé. Ces règles évoluent donc avec le temps.\nOn préfèrera alors l’ajout de règles qui possèdent un script qui <em>autofixera</em> toute la codebase intelligemment.\nDe nombreuses règles Eslint le proposent, et cela est vraiment un critère de sélection très important dans nos choix de nouvelles conventions.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">eslint --fix</code></pre></div>\n<p>Une règle très stricte qui vous obligera à modifier votre code manuellement avant chaque push est pénible à la longue et énervera vos équipes.\nAlors qu’une règle (même très stricte) qui peut s’autofixer automatiquement au moment du commit ne sera pas perçue comme gênante.</p>\n<p><strong>Comment décider d’ajouter de nouvelles règles ?</strong></p>\n<p>Cette question peut paraitre épineuse, prenons par exemple le cas des <code class=\"language-text\">&lt;tab></code> / <code class=\"language-text\">&lt;space></code> dans les fichiers.\nPour cela, on essaie d’éviter les débats sempiternels et on se plie à la tendance et aux règles de la communauté.\nPar exemple, <a href=\"https://github.com/M6Web/eslint-tools\">notre base de configuration Eslint</a>) est basée sur celle d’Airbnb qui semble avoir un certain succès dans la communauté JS.\nMais si la règle qu’on souhaite s’imposer n’est pas disponible dans Eslint ou d’autres outils, il nous arrive de préférer ne pas suivre la règle plutôt que de se dire “On le fait sans CI qui vérifie”.</p>\n<h3 id=\"la-liste-presque-exhaustive-\" style=\"position:relative;\"><a href=\"#la-liste-presque-exhaustive-\" aria-label=\"la liste presque exhaustive  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>La liste <em>presque</em> exhaustive 🤞</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/70d19ce71dc58f01820a31e0fee0aae5/e5715/ci-workflow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 116.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAABYlAAAWJQFJUiTwAAADRUlEQVQ4y41VaW/cNhT0//85RYCiH9q4KNDEbhw7ttfHrvbSipJ4U7e0OqbgW9txEWdrAoRICZw3fDPv6WSaJvR9j+cxDfjPGLoJ0/R933cjxuHwoigKsCihWTc1vTsZhgFpkqBpWlRNiUf2BU3boG1atG2Du/AMeeno+77rMWdfoVyCru3QtXss4xuEfIFhP4JzjhPP0DmHqqzp4Fx8QlWXkEIi5SmuNn8g4REYY4h2DJerjwjCGa2V0JhtPyNg36CEgZQSJ/jJKMsSXddh6Efs93sKmmUZcleiKEoYY1DXNaqqRlM3KMvicGXP8PUcx5E++MNaK1xEH8AVgxQKSZIgSWJim6YJZGpwE53ikZ1DphrD0B8YTk9ZfwY9JDx/Ecvn2VpLLK3OkbkczlkKkCYp5U4IQWd/uPIzYJ7lpOJKf0FW+Pwo5K5A6K6hi5gYF1mFpJhDlltktvjO8C1AD+Yjz8JPSDiDVhqMxXgIL7AK5+Apxy5kuA3Ocbe8JOscZ5jnL/nEBBijSYAJPYZxIFGsdSjrnFzh1z41PwX0osRxjGC5IBE8Wy0tzlcfsIxvyTKSG1yHH3EfnZEo4zgcZ+it43Pjr+8Z0VNlKPLqKSCjIB6c8/T4lclzRY578SdcocjozmQI9Gdwt4XgkkTZ2CvE2RzOvEMUb411fA+lJZx1MNrgcX2NmO/gXIZdGGG+mSHY3COJ3yFK27aoBotu30IpdaiQIqUS9apb42BLgbwysMYeF8UDaq1xtvwFqTzYJo05Lta/YScWUNKLonET/oWH6B8S6Kgo/sq+hjEAfX+oFGsNxj0wDqC9V96qDFY7CPmOStFG45L9CqFjCCFhlMMdP8VOemMLEmKhzrDVNzDyf3zoLdM0DaRJUNUHm/i5DgNILZBlOdXxNlpjx7ZQUmGaxiOARUl5lNUGeZmRwn7GNoByKdnIaIslmyESK7r2UYb+WVUVieAKja7bwyiLb5tT7HhAYL6p+ipZsCta+1J9s8FOr34i49Pvxkf3vrTGV0pJaykF7QlcqbcBXzN86QwAdW9vk9v0d4TiESKVcDrHA/8bK3kFIzNqGkcZvm64vtlmLsM2WkEbRS7w1eEFYfHupcH+C0jx45Z0wbNIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/70d19ce71dc58f01820a31e0fee0aae5/ba381/ci-workflow.webp 200w,\n/static/70d19ce71dc58f01820a31e0fee0aae5/7f61c/ci-workflow.webp 400w,\n/static/70d19ce71dc58f01820a31e0fee0aae5/8b983/ci-workflow.webp 768w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/70d19ce71dc58f01820a31e0fee0aae5/772e8/ci-workflow.png 200w,\n/static/70d19ce71dc58f01820a31e0fee0aae5/e17e5/ci-workflow.png 400w,\n/static/70d19ce71dc58f01820a31e0fee0aae5/e5715/ci-workflow.png 768w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/70d19ce71dc58f01820a31e0fee0aae5/e5715/ci-workflow.png\"\n            alt=\"Notre workflow d&#39;intégration continue\"\n            title=\"Notre workflow d&#39;intégration continue\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ul>\n<li>Le format des fichiers est suivi géré par <a href=\"https://editorconfig.org/\">Editorconfig</a>, <a href=\"https://prettier.io/\">prettier</a> et <a href=\"https://eslint.org/\">Eslint</a>.\nNous avons opensourcé <a href=\"https://github.com/M6Web/eslint-tools\">notre propre configuration</a>, si jamais celle-ci peut vous être utile.</li>\n<li>Nous utilisons un <a href=\"https://www.conventionalcommits.org/en/v1.0.0/\">nommage de commit bien spécifique</a> pour générer nos changelog.\nPour s’assurer que les devs le respectent, une simple étape de notre CI le vérifie.</li>\n<li>On ne souhaite pas qu’un dev fasse grossir énormément nos bundles JS en production, c’est pourquoi nous suivons et mesurons leur taille dans la CI.\nOn utilise un outil maison mais on peut vous recommander l’outil <a href=\"https://buildtracker.dev/\">BuildTracker</a>.</li>\n<li>La couverture de tests n’est pas un indicateur pour l’équipe, toutes les lignes n’ont pas la même nécessité pour nous d’être testées.\nCertaines équipes à Bedrock suivent cependant cet indicateur qui a au moins l’intérêt de donner une tendance.</li>\n<li>Nos tests unitaires tournent bien évidemment sur la CI, ceux-ci doivent passer.</li>\n<li>Nos tests fonctionnels (End to end: E2E) tournent sur Chrome Headless, ils doivent être au vert.</li>\n<li>Les logs de nos tests E2E sont récupérés et parsés afin d’éviter l’introduction d’erreur ou de React warning (Le script de parsing est cependant compliqué à maintenir)</li>\n<li>Les tests fonctionnels fonctionnent dans une <em>sandbox</em> où tout le réseau est proxyfié.\nNous surveillons que nos tests ne dépendent pas d’une API non mockée qui pourrait ralentir leur exécution.</li>\n<li>Durant les tests E2E nous vérifions qu’aucune requête d’image n’a généré une 404.</li>\n<li>On réalise quelques <a href=\"https://www.deque.com/axe/\">vérifications d’accessibilité avec Axe</a> durant nos tests E2E.</li>\n<li>On vérifie quelques règles sur le CSS avec <a href=\"https://stylelint.io/\">Stylelint</a> et <a href=\"https://github.com/M6Web/bemlinter\">bemlinter</a> (on n’utilise plus BEM aujourd’hui mais il reste encore un peu de style géré en SCSS qu’on migre petit à petit en StyledComponent)</li>\n<li>Le projet est un monorepo sur lequel nous essayons de maintenir les mêmes versions de dépendances pour chaque package.\nPour cela nous avons développé un outil qui permet de faire cette vérification <em><a href=\"https://www.npmjs.com/package/monorepo-dependencies-check\">monorepo-dependencies-check</a></em></li>\n<li>On vérifie que notre fichier <code class=\"language-text\">yarn.lock</code> n’a pas été modifié par inadvertance ou bien qu’il a été mis à jour par rapport aux modifications du <code class=\"language-text\">package.json</code>.</li>\n<li><a href=\"https://www.terraform.io/\">Terraform</a> est utilisé pour la gestion de nos ressources cloud, nous vérifions que le format des fichiers est correct.</li>\n</ul>\n<h2 id=\"tester-tester-tester\" style=\"position:relative;\"><a href=\"#tester-tester-tester\" aria-label=\"tester tester tester permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tester, tester, tester</h2>\n<p>J’espère qu’en 2021 il n’est plus nécessaire d’expliquer pourquoi tester automatiquement son application est indispensable pour la rendre pérenne.\nEn JS on est plutôt bien équipé en terme d’outils pour tester aujourd’hui.\nIl reste cependant l’éternelle question:</p>\n<blockquote>\n<p>“Qu’est-ce qu’on veut tester ?”</p>\n</blockquote>\n<p>Globalement si on recherche sur internet cette question, on voit que des besoins différents font émerger des pratiques et des outils de testing bien différents.\nCe serait très présomptueux de penser qu’il y a une bonne manière de tester automatiquement son application.\nC’est pourquoi il est préférable de définir une ou plusieurs stratégies de test qui répondent à des besoins définis et limités.</p>\n<p>Nos stratégies de tests reposent sur deux volontés bien distinctes:</p>\n<ul>\n<li>Automatiser la vérification des fonctionnalités proposées aux utilisateurs en se mettant à sa place.</li>\n<li>Nous fournir des solutions efficaces pour specifier la manière dont nous implémentons nos solutions techniques pour nous permettre de les faire évoluer plus facilement.</li>\n</ul>\n<p>Pour cela, nous réalisons deux “types de tests” que je propose de vous présenter ici.</p>\n<h3 id=\"nos-tests-e2e\" style=\"position:relative;\"><a href=\"#nos-tests-e2e\" aria-label=\"nos tests e2e permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nos tests E2E</h3>\n<p>On les appelle “tests fonctionels”, ce sont des tests End-to-end (E2E) sur une stack technique très efficace composée de <a href=\"https://cucumber.io/docs/installation/javascript/\">CucumberJS</a>, <a href=\"https://webdriver.io/\">WebdriverIO</a> avec <a href=\"https://developers.google.com/web/updates/2017/04/headless-chrome\">ChromeHeadless</a>\nIl s’agit d’une stack technique mise en place au début du projet (à l’époque avec <a href=\"https://phantomjs.org/\">PhantomJS</a> pour les plus anciens d’entre-vous)</p>\n<p>Cette stack nous permet d’automatiser le pilotage de tests qui contrôlent un navigateur.\nCe navigateur va réaliser des actions qui se rapprochent le plus de celles que nos vrais utilisateurs peuvent faire tout en vérifiant comment le site réagit.</p>\n<p>Il y a quelques années, cette stack technique était plutôt compliquée à mettre en place, mais aujourd’hui il est plutôt simple de le faire.\n<a href=\"https://github.com/Slashgear/slashgear.github.io\">Le site qui héberge cet article de blog</a> en est lui-même la preuve.\nIl ne m’a fallu qu’une dizaine de minutes pour mettre en place cette stack avec <a href=\"https://webdriver.io/docs/gettingstarted\">le WebdriverIo CLI</a> pour vérifier que mon blog fonctionne comme prévu.</p>\n<p>J’ai d’ailleurs récemment publié <a href=\"https://blog.slashgear.dev/how-to-setup-e2e-tests-with-webdriverio/\">un article présentant la mise en place de cette stack</a>.</p>\n<p>Voici donc un exemple de fichier de test E2E pour vous donner une idée:</p>\n<div class=\"gatsby-highlight\" data-language=\"gherkin\"><pre class=\"language-gherkin\"><code class=\"language-gherkin\"><span class=\"token feature\"><span class=\"token keyword\">Feature:</span><span class=\"token important\"> Playground</span>\n</span>\n  <span class=\"token scenario\"><span class=\"token keyword\">Background:</span><span class=\"token important\"> Playground context</span></span>\n    <span class=\"token atrule\">Given</span> <span class=\"token atrule\">I</span> use <span class=\"token string\">\"playground\"</span> test context\n\n  <span class=\"token scenario\"><span class=\"token keyword\">Scenario:</span><span class=\"token important\"> Check if playground is reachable</span></span>\n    <span class=\"token atrule\">When</span> As user <span class=\"token string\">\"toto@toto.fr\"</span> I visit the <span class=\"token string\">\"playground\"</span> page\n    <span class=\"token atrule\">And</span> <span class=\"token atrule\">I</span> click on <span class=\"token string\">\"playground trigger\"</span>\n    <span class=\"token atrule\">Then</span> <span class=\"token atrule\">I</span> should see a <span class=\"token string\">\"visible playground\"</span>\n    <span class=\"token atrule\">And</span> <span class=\"token atrule\">I</span> should see 4 <span class=\"token string\">\"playground tab\"</span> in <span class=\"token string\">\"playground\"</span>\n\n    <span class=\"token atrule\">When</span> <span class=\"token atrule\">I</span> click on <span class=\"token string\">\"playground trigger\"</span>\n    <span class=\"token atrule\">Then</span> <span class=\"token atrule\">I</span> should not see a <span class=\"token string\">\"visible playground\"</span>\n\n    <span class=\"token comment\"># ...</span></code></pre></div>\n<p>Et ça donne ça en local avec mon navigateur Chrome !</p>\n<p><img src=\"/32bbadf844172a03f1f0a39a3cee3faa/e2e-example.gif\" alt=\"Exemple d&#x27;exécution de test fonctionnel\"></p>\n<p>Voilà un schéma qui explique comment cette stack fonctionne:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8de3947494607606cd09c4b4a110bef5/ac307/e2e-archi.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAABuUlEQVQ4y32T65KbMAyFef+nbH/ttiTEAV9lyacjgbPQ9cYzGrCxPh8fiQmD0VqzJzEhUoKLT9zDA0t0iBQRSoLIdX+P6R2wHMBHdJj9HTe/INcM5yNCFKTMEGmXnLdAfUrbpTzTChY+vu3fmRtykUveNIL09yoVqWa7+pY9Si22JiI4tqCQwIeKxZEdML0AJ1AfemWFqbqP5x/zUueJUpcBqmJRq4wVaoJLq831uQS3Fyat8CWYSuL6OpQOUB9TU/lHySpXM90nbyrUs+7hTz6rh+fCTOw9NMrnJ/I8o9xmgAiS0rAtzjEEaqIQoToHmmeD61xK2RO1olbY7x7rCJEHVz4WOEYD1W0Dh3Cc2hV+qS1FkLPAR8a8FKxbNS9j4r0ollAzmhAkJ3DwaJSPNb54ptdLWVC5Yb4XA94ftLdP7EAKaEwQfwMvv8CP35Dk0EgV+299qjANhffQHlTlO5CrARUs6Wlgydu+JvXa8AMfz2MaGd2a2HVVpeR12DI/xTTa0FVLuEHi8nWI/ssnT0dipv9PtXdtaLtyMSBvf03pa/1o9rfAq/GyA7QofgavH5CymZ+69g74D+B9PfA/sptVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8de3947494607606cd09c4b4a110bef5/ba381/e2e-archi.webp 200w,\n/static/8de3947494607606cd09c4b4a110bef5/7f61c/e2e-archi.webp 400w,\n/static/8de3947494607606cd09c4b4a110bef5/d00b9/e2e-archi.webp 800w,\n/static/8de3947494607606cd09c4b4a110bef5/92f8c/e2e-archi.webp 1200w,\n/static/8de3947494607606cd09c4b4a110bef5/fad48/e2e-archi.webp 1600w,\n/static/8de3947494607606cd09c4b4a110bef5/b8ebc/e2e-archi.webp 2058w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8de3947494607606cd09c4b4a110bef5/772e8/e2e-archi.png 200w,\n/static/8de3947494607606cd09c4b4a110bef5/e17e5/e2e-archi.png 400w,\n/static/8de3947494607606cd09c4b4a110bef5/5a190/e2e-archi.png 800w,\n/static/8de3947494607606cd09c4b4a110bef5/c1b63/e2e-archi.png 1200w,\n/static/8de3947494607606cd09c4b4a110bef5/29007/e2e-archi.png 1600w,\n/static/8de3947494607606cd09c4b4a110bef5/ac307/e2e-archi.png 2058w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8de3947494607606cd09c4b4a110bef5/5a190/e2e-archi.png\"\n            alt=\"schéma qui explique le fonctionnement de notre stack\"\n            title=\"schéma qui explique le fonctionnement de notre stack\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Aujourd’hui, l’application web de Bedrock possède plus de 800 scénarios de tests E2E qui tournent sur chacune de nos <em>Pull Request</em> et sur la branche <code class=\"language-text\">master</code>.\nIls nous assurent que nous n’introduisons pas de régression fonctionnelle et c’est juste génial !</p>\n<p>👍 Les points positifs</p>\n<ul>\n<li>WebdriverIO nous permet également de lancer de manière journalière ces mêmes tests sur des vrais devices en passant par le service payant SAAS <a href=\"https://www.browserstack.com/\">Browserstack</a>.\nOn a donc tous les jours un <em>job</em> qui s’assure que notre site fonctionne correctement sur un Chrome dernière version sur Windows 10 et Safari sur MacOs.</li>\n<li>Ces tests nous permettent de facilement documenter les fonctionnalités de l’application grâce au langage Gherkin.</li>\n<li>Ils nous permettent de reproduire des cas qui sont loin d’être nominaux.\nDans une logique <em>TDD</em>, ils permettent d’avancer sur le développement sans avoir à cliquer pendant des heures.</li>\n<li>Ces tests nous ont permis de ne pas casser l’ancienne version du site qui est toujours en production pour quelques clients alors que nos efforts se concentrent sur la nouvelle.</li>\n<li>Ils nous apportent une vraie confiance.</li>\n<li>Grâce notre librairie <a href=\"https://www.npmjs.com/package/superagent-mock\"><em>superagent-mock</em></a>, nous pouvons <em>fixturer</em> (bouchonner, mocker) toutes les API dont on dépend et ainsi même vérifier les cas d’erreurs.\nDe plus, mocker la couche XHR du navigateur permet une amélioration significative du temps d’exécution des tests. 🚀</li>\n<li>Ils nous donne accès à des usages étendus comme :\n<ul>\n<li>vérification de règles d’accessibilité</li>\n<li>check les logs de la console navigateur (pour ne pas introduire d’erreur ou de React Warning par exemple)</li>\n<li>surveiller tous les appels réseaux du site grâce à un proxy</li>\n<li>et j’en passe…</li>\n</ul>\n</li>\n</ul>\n<p>👎 Les complications</p>\n<ul>\n<li>Maintenir cette stack est compliqué et coûteux.\nÉtant donné que peu de ressources sont publiées sur ce domaine, on se retrouve parfois à devoir creuser pendant plusieurs jours pour les réparer 😅.\nIl nous arrive de nous sentir parfois bien seul à avoir ces soucis.</li>\n<li>Il est très facile de coder un test E2E dit <em>flaky</em> (ie: un test qui peut échouer aléatoirement).\nIls nous font croire que quelque chose est cassé.\nIls nous prennent parfois du temps à les stabiliser.\nIl reste cependant <strong>bien meilleur de supprimer un test qui ne vous donnera pas un résultat stable.</strong></li>\n<li>Faire tourner tous les tests prend un temps important sur notre intégration continue.\nIl faut régulièrement travailler sur leur optimisation pour que le feedback qu’ils vous apportent soit le plus rapide possible.\nCes temps importants coutent également de l’argent, il faut en effet bien faire tourner ces tests sur des machines.\nPour information, l’infrastructure du site web (à lui seul, juste l’hébergement de nos servers Node + fichiers statiques + CDN) coutent bien moins cher que notre intégration continue.\nCela fait bien évidemment sourire nos Ops ! 😊</li>\n<li>Les nouvelles recrues de nos équipes n’ont souvent jamais réalisé ce genre de tests, il y a donc une phase <del>de galère</del> d’apprentissage..</li>\n<li>Certaines fonctionnalités sont parfois trop compliquées à tester avec notre stack E2E (par exemple, les parcours de paiement qui dépendent de tiers).\nIl nous arrive alors de nous rabattre sur d’autres techniques avec Jest notamment en ayant un scope moins unitaire.</li>\n</ul>\n<h3 id=\"nos-tests-unitaires\" style=\"position:relative;\"><a href=\"#nos-tests-unitaires\" aria-label=\"nos tests unitaires permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nos tests “unitaires”</h3>\n<p>Pour compléter nos tests fonctionnels nous avons également une stack de tests écrits avec <a href=\"https://jestjs.io/fr/\">Jest</a>.\nOn qualifie ces tests d’unitaires car nous avons comme principe d’essayer de toujours tester nos modules JS en indépendance des autres.</p>\n<p><em>Ne débattons pas ici sur “Est-ce que ce sont des vrais tests unitaires ?”, suffisamment d’articles sur internet traitent de ce sujet.</em></p>\n<p>On utilise ces tests pour différentes raisons qui couvrent des besoins que nos tests fonctionnels ne couvrent pas:</p>\n<ul>\n<li>nous aider à développer nos modules JS avec des pratiques TDD.</li>\n<li>documenter et décrire comment fonctionne un module JS.</li>\n<li>tester des cas limites très/trop compliqués à tester avec nos tests E2E.</li>\n<li>faciliter le refactoring de notre application en nous montrant les impacts techniques de nos modifications.</li>\n</ul>\n<p>Avec ces tests, on se met au niveau d’une fonction utilitaire, d’une action Redux, d’un reducer, d’un composant React.\nOn se base essentiellement sur <a href=\"https://blog.slashgear.dev/discover-jest-hidden-feature-automock/\">la fonctionnalité d’<code class=\"language-text\">automock</code> de Jest</a> qui nous propose d’isoler nos modules JS lorsqu’on teste.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8c790d7bb84694543ba87dcb7a7e76ae/0f98f/mocked-modules.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAMF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB3IA2RJ//xAAYEAADAQEAAAAAAAAAAAAAAAAAARIQE//aAAgBAQABBQI6ZTKZTP/EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/ASf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAYEAACAwAAAAAAAAAAAAAAAAAAAiAzkf/aAAgBAQAGPwIrbI//xAAZEAADAQEBAAAAAAAAAAAAAAAAASFhoRH/2gAIAQEAAT8hPQlUozTgoXhof//aAAwDAQACAAMAAAAQKw//xAAXEQEAAwAAAAAAAAAAAAAAAAABEBEx/9oACAEDAQE/EEGlx//EABYRAAMAAAAAAAAAAAAAAAAAAAEQEf/aAAgBAgEBPxA1f//EABwQAAEFAQEBAAAAAAAAAAAAAAEAESExUUFhwf/aAAgBAQABPxACa54mDawxKYUQOHZhCGKsLhKwox8Bf//Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8c790d7bb84694543ba87dcb7a7e76ae/ba381/mocked-modules.webp 200w,\n/static/8c790d7bb84694543ba87dcb7a7e76ae/7f61c/mocked-modules.webp 400w,\n/static/8c790d7bb84694543ba87dcb7a7e76ae/d00b9/mocked-modules.webp 800w,\n/static/8c790d7bb84694543ba87dcb7a7e76ae/92f8c/mocked-modules.webp 1200w,\n/static/8c790d7bb84694543ba87dcb7a7e76ae/fad48/mocked-modules.webp 1600w,\n/static/8c790d7bb84694543ba87dcb7a7e76ae/882b9/mocked-modules.webp 1920w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8c790d7bb84694543ba87dcb7a7e76ae/e07e9/mocked-modules.jpg 200w,\n/static/8c790d7bb84694543ba87dcb7a7e76ae/066f9/mocked-modules.jpg 400w,\n/static/8c790d7bb84694543ba87dcb7a7e76ae/4b190/mocked-modules.jpg 800w,\n/static/8c790d7bb84694543ba87dcb7a7e76ae/e5166/mocked-modules.jpg 1200w,\n/static/8c790d7bb84694543ba87dcb7a7e76ae/b17f8/mocked-modules.jpg 1600w,\n/static/8c790d7bb84694543ba87dcb7a7e76ae/0f98f/mocked-modules.jpg 1920w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8c790d7bb84694543ba87dcb7a7e76ae/4b190/mocked-modules.jpg\"\n            alt=\"représentation visuelle de l&#39;automock\"\n            title=\"représentation visuelle de l&#39;automock\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>L’image précédente représente la métaphore qui nous permet d’expliquer notre stratégie de tests unitaires aux nouveaux arrivant.</p>\n<blockquote>\n<p>“Il faut s’imaginer que l’application est un mur composé de briques unitaires (nos modules ecmascript), nos tests unitaires doivent tester une à une les briques en indépendance totale des autres.\nNos tests fonctionnels sont là pour tester le ciment entre les briques.”</p>\n</blockquote>\n<p><strong>Pour résumer, on pourrait dire que nos tests E2E testent <em>ce que notre application doit faire</em>, et nos tests unitaires s’assurent eux de vérifier <em>comment ça marche.</em></strong></p>\n<p>Aujourd’hui ce sont plus de 6000 tests unitaires qui couvrent l’application et permettent de limiter les régressions.</p>\n<p>👍</p>\n<ul>\n<li><a href=\"https://jestjs.io/fr/\">Jest</a> est vraiment une librairie géniale, rapide, complète, bien documentée.</li>\n<li>Les tests unitaires nous aident beaucoup à comprendre <em>plusieurs années après</em> comment tout cela fonctionne.</li>\n<li>On arrive toujours à tester unitairement notre code, et cela complète bien nos tests E2E.</li>\n<li>L’<code class=\"language-text\">automock</code> est vraiment pratique pour le découpage de tests par modules.</li>\n</ul>\n<p>👎</p>\n<ul>\n<li>Parfois, nous nous sommes trouvés limités par notre stack de tests E2E et nous ne pouvions pas uniquement nous baser sur les tests unitaires.\nIl nous manquait quelque chose pour pouvoir s’assurer que le <em>ciment entre les briques</em> fonctionnait comme on le souhaitait.\nPour cela, il a été mis en place une deuxième stack de tests <a href=\"https://jestjs.io/fr/\">Jest</a> nommé “test d’intégration” ou l’<code class=\"language-text\">automock</code> est désactivé.</li>\n<li>L’abus de <a href=\"https://jestjs.io/docs/snapshot-testing\"><em>Snapshot</em></a> est dangereux pour la santé.\nL’usage du <em>“Snapshot testing”</em> peut faire gagner du temps sur l’implémentation de vos tests mais peuvent en réduire la qualité.\nAvoir à review un object de 50 lignes en <em>Snapshot</em> est ni facile, ni pertinent.</li>\n<li>Avec la dépréciation d’<a href=\"https://enzymejs.github.io/enzyme/\">EnzymeJS</a>, nous sommes contraints de migrer sur <a href=\"https://testing-library.com/docs/react-testing-library/intro/\">React Testing Library</a>.\nIl est bien évidemment possible de tester unitairement des composants avec cette nouvelle librairie.\nMalheureusement, ce n’est pas vraiment l’esprit et la façon de faire.\n<a href=\"https://testing-library.com/docs/react-testing-library/intro/\">React Testing Library</a> nous pousse <a href=\"https://kentcdodds.com/blog/why-i-never-use-shallow-rendering\">à ne pas jouer avec le <em>shallow rendering</em></a>.</li>\n</ul>\n<h3 id=\"nos-principes\" style=\"position:relative;\"><a href=\"#nos-principes\" aria-label=\"nos principes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nos principes</h3>\n<p>Nous essayons de toujours respecter les règles suivantes lorsqu’on se pose la question “Dois-je ajouter des tests ?“.</p>\n<ol>\n<li>Si notre <em>Pull Request</em> introduit des nouvelles fonctionnalités utilisateurs, il faut intégrer des scenarios de test E2E.\nDes tests unitaires avec Jest peuvent les compléter / remplacer en fonction.</li>\n<li>Si notre <em>Pull Request</em> a pour but de corriger un bug, cela signifie qu’il nous manque un cas de test.\nOn doit donc essayer de rajouter un test E2E ou à défaut un test unitaire.</li>\n</ol>\n<p><em>C’est en écrivant ces lignes que je me dis que ces principes pourraient très bien faire l’objet d’une automatisation.</em> 🤣</p>\n<h2 id=\"le-projet-reste-les-fonctionnalités-non\" style=\"position:relative;\"><a href=\"#le-projet-reste-les-fonctionnalit%C3%A9s-non\" aria-label=\"le projet reste les fonctionnalités non permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Le projet reste, les fonctionnalités non</h2>\n<blockquote>\n<p>“La seconde évolution d’une fonctionnalité est très souvent sa suppression.”</p>\n</blockquote>\n<p>Par principe, nous souhaitons faire en sorte que chaque nouvelle fonctionnalité de l’application ne base pas son activation sur le simple fait d’être dans la codebase.\nClassiquement, le cycle de vie d’une “feature” dans un projet peut être le suivant (dans un <a href=\"https://guides.github.com/introduction/flow/\">Github Flow</a>):</p>\n<ul>\n<li>une personne implémente sur une branche</li>\n<li>la fonctionnalité est <em>mergée</em> sur master</li>\n<li>elle est déployée en production</li>\n<li>vis sa vie de fonctionnalité (avec parfois des bugs et des correctifs)</li>\n<li>la fonctionnalité n’est plus nécessaire</li>\n<li>une personne détricote le code et l’enlève</li>\n<li>nouveau déploiement</li>\n</ul>\n<p>Pour simplifier certaines étapes, il a été mis en place du <em>feature flipping</em> sur le projet.</p>\n<p><strong>Comment ça marche ?</strong></p>\n<p>Dans notre config il y a une <em>map</em> clé/valeur qui liste toutes les fonctionnalités de l’application associées à leur statut d’activation.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> featureFlipping <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  myAwesomeFeature<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  anotherOne<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Dans notre code, nous avons donc implémenté des traitements conditionnels qui disent “Si cette feature est activée alors…“.\nCela peut changer le rendu d’un composant, changer l’implémentation d’une action Redux ou bien désactiver une route de notre <em>react-router</em>.</p>\n<p><strong>Mais à quoi ça sert ?</strong></p>\n<ul>\n<li>On peut développer des nouvelles évolutions progressivement en les cachant derrière une clé de configuration.\nOn livre des fonctionnalités en production sans les activer.</li>\n<li>En environnement de test, on peut surcharger cette config pour tester des features qui ne sont pas encore activées en production.</li>\n<li>Dans le cas d’un site en marque blanche, on peut proposer ces fonctionnalités à nos clients comme des options possibles.</li>\n<li>Avant de supprimer le code d’une feature, on la désactive puis on fait le ménage sans risque.</li>\n<li>Grâce à un outil maison nommé l’<em>Applaunch</em>, cette config de feature flipping est surchargeable dans une interface graphique à chaud sans déploiement.\nCela nous permet d’activer des fonctionnalités sans faire de mise en production du code.\nEn cas d’incident, on peut désactiver des fonctionnalités qui sont dégradées.</li>\n</ul>\n<p>Pour vous donner un exemple plus concret, entre 2018 et 2020 nous avons complètement refondu l’interface de l’application.\nCette évolution graphique n’était qu’une clé de featureFlipping.\nLa refonte graphique n’a donc pas été la remise à zéro du projet, on continue encore aujourd’hui de vivre avec les deux versions (tant que la bascule de tous nos clients n’est pas terminée).</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1148bec58444fa4ccea56315b956b236/0f98f/compare-v4-v5.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.000000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAQD/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQAC/9oADAMBAAIQAxAAAAGScbMaP//EABkQAAIDAQAAAAAAAAAAAAAAAAABAxESIf/aAAgBAQABBQK+uRm2f//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABYRAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAgEBPwGMf//EABYQAQEBAAAAAAAAAAAAAAAAAAECEP/aAAgBAQAGPwKZQ3//xAAcEAEAAQQDAAAAAAAAAAAAAAABABEhMUFRcbH/2gAIAQEAAT8hreRRD2YgFtzon//aAAwDAQACAAMAAAAQA9//xAAXEQADAQAAAAAAAAAAAAAAAAAAAREx/9oACAEDAQE/EGrpEf/EABcRAQEBAQAAAAAAAAAAAAAAAAEAESH/2gAIAQIBAT8QA8bF/8QAGxAAAQUBAQAAAAAAAAAAAAAAAQARITGRUWH/2gAIAQEAAT8QoVAtYyI9VSOyxkeOV//Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/1148bec58444fa4ccea56315b956b236/ba381/compare-v4-v5.webp 200w,\n/static/1148bec58444fa4ccea56315b956b236/7f61c/compare-v4-v5.webp 400w,\n/static/1148bec58444fa4ccea56315b956b236/d00b9/compare-v4-v5.webp 800w,\n/static/1148bec58444fa4ccea56315b956b236/92f8c/compare-v4-v5.webp 1200w,\n/static/1148bec58444fa4ccea56315b956b236/fad48/compare-v4-v5.webp 1600w,\n/static/1148bec58444fa4ccea56315b956b236/882b9/compare-v4-v5.webp 1920w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/1148bec58444fa4ccea56315b956b236/e07e9/compare-v4-v5.jpg 200w,\n/static/1148bec58444fa4ccea56315b956b236/066f9/compare-v4-v5.jpg 400w,\n/static/1148bec58444fa4ccea56315b956b236/4b190/compare-v4-v5.jpg 800w,\n/static/1148bec58444fa4ccea56315b956b236/e5166/compare-v4-v5.jpg 1200w,\n/static/1148bec58444fa4ccea56315b956b236/b17f8/compare-v4-v5.jpg 1600w,\n/static/1148bec58444fa4ccea56315b956b236/0f98f/compare-v4-v5.jpg 1920w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/1148bec58444fa4ccea56315b956b236/4b190/compare-v4-v5.jpg\"\n            alt=\"screenshot comparatif v4 / v5 sur 6play\"\n            title=\"screenshot comparatif v4 / v5 sur 6play\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"lab-testing\" style=\"position:relative;\"><a href=\"#lab-testing\" aria-label=\"lab testing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>L’A/B testing</h3>\n<p>Grâce au super travail des équipes backend et data, on a pu même étendre l’usage du <em>feature flipping</em> en rendant cette configuration modifiable pour des sous groupes d’utilisateurs.</p>\n<p>Cela permet de déployer des nouvelles fonctionnalités sur une portion plus réduite des utilisateurs afin de comparer nos <a href=\"https://www.journaldunet.fr/business/dictionnaire-du-marketing/1198189-kpi-key-performance-indicator-marketing-definition-exemples-okr/\">KPI</a>.</p>\n<p>Prise de décision, amélioration des performances techniques ou produit, expérimentations, les possibilités sont nombreuses et nous les exploitons de plus en plus.</p>\n<h3 id=\"le-futur-flipping\" style=\"position:relative;\"><a href=\"#le-futur-flipping\" aria-label=\"le futur flipping permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Le <em>futur flipping</em></h3>\n<blockquote>\n<p>Sur une idée originale de <a href=\"https://twitter.com/SuperFlaw\">Florent Lepretre</a>.</p>\n</blockquote>\n<p>Nous avions régulièrement le besoin d’activer des feature à des heures <del>très</del> trop matinales dans le futur.\nPour cela nous devions être connecté à une heure précise sur notre poste pour modifier la configuration à chaud.</p>\n<p>Afin d’éviter d’oublier de le faire, ou de le faire en retard, nous avons fait en sorte qu’une clé de configuration puisse être activée à partir d’une certaine date.\nPour cela, nous avons fait évoluer notre <em>selector redux</em> qui indiquait si une feature était activée pour qu’il puisse gérer des formats de date et les comparer à l’heure courante.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> featureFlipping <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  myAwesomeFeature<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    offDate<span class=\"token operator\">:</span> <span class=\"token string\">'2021-07-12 20:30:00'</span><span class=\"token punctuation\">,</span>\n    onDate<span class=\"token operator\">:</span> <span class=\"token string\">'2021-07-12 19:30:00'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>De nombreux cafés ☕️ à 9h ont été sauvés grâce au <em>futur flipping</em></p>\n</blockquote>\n<h2 id=\"monitorer-mesurer-alerter\" style=\"position:relative;\"><a href=\"#monitorer-mesurer-alerter\" aria-label=\"monitorer mesurer alerter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Monitorer, Mesurer, Alerter</h2>\n<p>Pour maintenir un projet aussi longtemps que l’application web de bedrock, des tests, de la documentation et de la rigueur ne suffisent pas.\nIl faut également de la visibilité sur ce qui marche en production.</p>\n<blockquote>\n<p>“Comment sais-tu que l’application que tu as en production en ce moment même fonctionne comme prévu ?”</p>\n</blockquote>\n<p>On part du principe qu’aucune fonctionnalité ne marche tant qu’elle n’est pas monitorée.\nAujourd’hui le monitoring à Bedrock coté Frontend se matérialise par différents outils et différentes stacks.\nJe pourrais vous citer <a href=\"https://newrelic.com/\">NewRelic</a>, un <a href=\"https://github.com/statsd/statsd\">Statsd</a>, une stack <a href=\"https://www.elastic.co/fr/what-is/elk-stack\">ELK</a> ou bien encore <a href=\"https://youbora.nicepeopleatwork.com/\">Youbora</a> pour la vidéo.</p>\n<p>Pour vous donner un exemple, à chaque fois qu’un utilisateur commence une session de navigation on envoie un <em>Hit</em> de monitoring anonyme pour incrémenter un compteur dans Statsd.\nOn a alors plus qu’à définir un dashboard qui affiche dans un graphique l’évolution de ce nombre.\nSi on observe une variation trop importante, cela peut nous permettre de détecter un incident.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5da9f76c5fa5325b394418fa229d9204/0b894/grafana-monitoring-example.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABv0lEQVQoz3WSW0/bQBCF8xMCSW2v7fXu2iYhgrQPFIOhKsQJsROHSyuhhlZV+1DKrbT//+lUM06E06gPn9aeOT5zZuWGL2Mo3YUMIghXw7I8eDKCJQyazVfY2LSx2XL4rNPcsNBqCzgigO1IOK5ij4bjBiBsN4DwNISn4MkQwjewheSeH0RY6hgyEZKxHJ9Z9hqur0GQEZ2e1NxwF+/13hLS+Mqs1dcMvcDgoDiANOGauP6R6WyxTrj/M5SamyqOMbsvsJP0YduS6yvplYHtBOjt7bIu3O7w+iuGJKZiu+VhZ7+Pq98lknFSGdbMSGPZEu22h/2zBB/+zNBP38CyloPVIqHU2Or3sHv4GuNvQ1w8TjD4dLKYqvi+yCjsdbGXveX0+fcRLn9NkZYpJ15JSHdB8Zm7HOVtjuntmNchMf0SptvB2dcMV89lpflZQQGkDjk9b0qGF09TnD8UL6b3BU9///EdJ6T0kx9jkK68y2vDC1w+T5HkCafztakMhzcDZPMBhsTNgvkAo88ZjmdHOL0+wehLhmx++tL/h+PzI6STlNM2TLQNPwjhy7A6awQmhlTRWp1+9Pqz1BGUiXntv+9bR90JzYdyAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/5da9f76c5fa5325b394418fa229d9204/ba381/grafana-monitoring-example.webp 200w,\n/static/5da9f76c5fa5325b394418fa229d9204/7f61c/grafana-monitoring-example.webp 400w,\n/static/5da9f76c5fa5325b394418fa229d9204/d00b9/grafana-monitoring-example.webp 800w,\n/static/5da9f76c5fa5325b394418fa229d9204/92f8c/grafana-monitoring-example.webp 1200w,\n/static/5da9f76c5fa5325b394418fa229d9204/fad48/grafana-monitoring-example.webp 1600w,\n/static/5da9f76c5fa5325b394418fa229d9204/20a05/grafana-monitoring-example.webp 3702w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/5da9f76c5fa5325b394418fa229d9204/772e8/grafana-monitoring-example.png 200w,\n/static/5da9f76c5fa5325b394418fa229d9204/e17e5/grafana-monitoring-example.png 400w,\n/static/5da9f76c5fa5325b394418fa229d9204/5a190/grafana-monitoring-example.png 800w,\n/static/5da9f76c5fa5325b394418fa229d9204/c1b63/grafana-monitoring-example.png 1200w,\n/static/5da9f76c5fa5325b394418fa229d9204/29007/grafana-monitoring-example.png 1600w,\n/static/5da9f76c5fa5325b394418fa229d9204/0b894/grafana-monitoring-example.png 3702w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/5da9f76c5fa5325b394418fa229d9204/5a190/grafana-monitoring-example.png\"\n            alt=\"exemple de dashboard de suivi\"\n            title=\"exemple de dashboard de suivi\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Le monitoring nous offre aussi des solutions pour comprendre et analyser un bug qui s’est produit dans le passé.\nComprendre un incident, l’expliquer, en trouver sa <em>root cause</em> sont les possibilités qui s’offrent à vous si vous monitorez votre application.\nLe monitoring peut également permettre de mieux communiquer avec les clients sur les impacts d’un incident et également d’estimer le nombre d’utilisateurs impactés.</p>\n<p>Avec la multiplication de nos clients, bien monitorer nos plateformes n’est plus suffisant.\nTrop de données, trop de dashboards à surveiller, il devient très facile de louper quelque chose.\nNous avons donc commencé à compléter notre suivi des mesures par de l’<em>alerting</em> automatique.\nUne fois que les mesures nous apportent suffisamment de confiance, on peut facilement mettre en place des alertes qui vont nous prévenir en cas de valeur incohérente.</p>\n<p>Nous essayons cependant de toujours déclencher des alertes uniquement quand celle-ci est actionnable.\nDans d’autres termes, si une alerte sonne, nous avons quelque chose à faire.\nFaire sonner des alertes qui ne nécessitent aucune action immédiate humaine génèrent du bruit et de la perte de temps.</p>\n<p><img src=\"/c625b00a7bffa65b2f54cbae9c8ef14e/alerte-taxi.gif\" alt=\"alerte générale\"></p>\n<h2 id=\"limiter-surveiller-et-mettre-à-jour-ses-dépendances\" style=\"position:relative;\"><a href=\"#limiter-surveiller-et-mettre-%C3%A0-jour-ses-d%C3%A9pendances\" aria-label=\"limiter surveiller et mettre à jour ses dépendances permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Limiter, surveiller et mettre à jour ses dépendances</h2>\n<p>Ce qui périme plus vite que votre ombre dans un projet web basé sur des technologies javascript, ce sont vos dépendances.\nL’écosystème évolue rapidement et vos dépendances peuvent vite se retrouver non maintenues, plus à la mode ou bien complètement refondues avec de gros <em>breaking changes</em>.</p>\n<p>On essaye donc dans la mesure du possible de limiter nos dépendances et d’éviter d’en ajouter inutilement.\nUne dépendance, c’est souvent très facile à ajouter mais elle peut devenir un vrai casse-tête à enlever.</p>\n<p>Les librairies de composants graphiques (exemple React bootstrap, Material Design) sont un bel exemple de dépendance que nous tenons à ne pas introduire.\nElles peuvent faciliter l’intégration dans un premier temps mais celles-ci bloquent souvent la version de votre librairie de composant par la suite.\nVous ne voulez pas figer la version de React dans votre application pour deux composants de formulaires.</p>\n<p>La surveillance fait aussi partie de nos routines de gestion de nos dépendances.\nDepuis l’ajout du <a href=\"https://docs.npmjs.com/auditing-package-dependencies-for-security-vulnerabilities\">signalement de failles de sécurité dans un package NPM</a>, il est possible de savoir si un projet intègre une dépendance qui contient une faille de sécurité connue par une simple commande.\nNous avons donc des jobs journaliers sur nos projets qui lancent la commande <code class=\"language-text\">yarn audit</code> afin de nous forcer à appliquer les correctifs.</p>\n<blockquote>\n<p>La maintenance de dépendances est grandement facilité par notre stack de tests E2E qui sonnent direcement si la montée de version génère une regression.</p>\n</blockquote>\n<p>Aujourd’hui, hors failles de sécurité, nous mettons à jour nos dépendances “quand on a le temps”, souvent en fin de <em>sprint</em>.\nCela ne nous satisfait pas car certaines dépendances peuvent se retrouver oubliées.\nJ’ai personnellement l’habitude d’utiliser des outils comme <a href=\"https://classic.yarnpkg.com/en/docs/cli/outdated/\"><code class=\"language-text\">yarn outdated</code></a> et <a href=\"https://dependabot.com/\">Dependabot</a> sur mes projets personels pour automatiser la mise à jour de mes dépendances.</p>\n<h2 id=\"accepter-sa-dette-technique\" style=\"position:relative;\"><a href=\"#accepter-sa-dette-technique\" aria-label=\"accepter sa dette technique permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Accepter sa dette technique</h2>\n<p>Un projet accumulera toujours de la dette technique.\n<strong>C’est un fait.</strong>\nQue ce soit de la dette volontaire ou involontaire, un projet qui résiste aux années va forcément accumuler de la dette.\nD’autant plus, si pendant toutes ces années vous continuez d’ajouter des fonctionnalités.</p>\n<p>Depuis 2014, nos bonnes pratiques, nos façons de faire ont bien évolué.\nParfois nous avons décidé ces changements mais parfois nous les avons subi (un exemple, l’arrivée des composants fonctionnels avec React et l’api des Hooks).</p>\n<p><strong>Notre projet n’est pas complètement <em>“state of art”</em> et on l’assume.</strong></p>\n<p><img src=\"/c80d0cd308b5657d54f976a32fe2c811/leak.gif\" alt=\"ça tiendra !\"></p>\n<p>Nous essayons de prioriser nos sujets de <em>refactoring</em> sur les parties de l’application sur lequel on a le plus de souci, le plus de peine.\nOn considère qu’une partie de l’application qui ne nous plaît pas mais sur laquelle on n’a pas besoin de travailler (apporter des évolutions) ne mérite pas qu’on la refactorise.</p>\n<p>Je pourrais vous citer de nombreuses fonctionnalités de notre application qui n’ont pas évolué fonctionnellement depuis plusieurs années.\nMais comme nous avons couvert ces fonctionnalités de tests E2E depuis le début, nous n’avons pas vraiment eu à y retoucher.</p>\n<p>Comme dit plus haut, la prochaine évolution d’une feature de code est parfois sa désactivation.\nAlors pourquoi passer son temps à ré-écrire toute l’application ?</p>\n<ul>\n<li>Le code devient dans tous les cas du “legacy”.</li>\n<li>Tant que les fonctionnalités sont testées, rien ne nous oblige à tout refactorer en permanence pour que toute notre codebase soit <em>state of art</em>.</li>\n<li>On se focalise sur nos <em>pain points</em>, on re-factorise ce qu’on a vraiment besoin de faire évoluer.</li>\n</ul>\n<h2 id=\"pour-résumer\" style=\"position:relative;\"><a href=\"#pour-r%C3%A9sumer\" aria-label=\"pour résumer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pour résumer</h2>\n<p>Les bonnes pratiques présentées ici restent bien évidemment subjectives et ne s’appliqueront pas parfaitement/directement dans vos contextes.\nJe suis cependant convaincu qu’elles peuvent probablement vous aider à identifier ce qui peut faire passer votre projet de fun à périmé.\nÀ Bedrock nous avons mis en place d’autres pratiques que je n’ai pas listées ici mais ce sera l’occasion de faire un nouvel article un jour.</p>\n<p>Enfin, si vous souhaitez que je revienne plus en détail sur certains chapitres présentés ici, n’hésitez pas à me le dire, je pourrais essayer d’y dédier un article spécifique.</p>","headings":[{"value":"Un peu de contexte"},{"value":"S’imposer des règles et les automatiser"},{"value":"La liste presque exhaustive 🤞"},{"value":"Tester, tester, tester"},{"value":"Nos tests E2E"},{"value":"Nos tests “unitaires”"},{"value":"Nos principes"},{"value":"Le projet reste, les fonctionnalités non"},{"value":"L’A/B testing"},{"value":"Le futur flipping"},{"value":"Monitorer, Mesurer, Alerter"},{"value":"Limiter, surveiller et mettre à jour ses dépendances"},{"value":"Accepter sa dette technique"},{"value":"Pour résumer"}],"wordCount":{"words":4276},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#un-peu-de-contexte\">Un peu de contexte</a></p>\n</li>\n<li>\n<p><a href=\"#simposer-des-r%C3%A8gles-et-les-automatiser\">S’imposer des règles et les automatiser</a></p>\n<ul>\n<li><a href=\"#la-liste-presque-exhaustive-\">La liste <em>presque</em> exhaustive 🤞</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#tester-tester-tester\">Tester, tester, tester</a></p>\n<ul>\n<li><a href=\"#nos-tests-e2e\">Nos tests E2E</a></li>\n<li><a href=\"#nos-tests-unitaires\">Nos tests “unitaires”</a></li>\n<li><a href=\"#nos-principes\">Nos principes</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#le-projet-reste-les-fonctionnalit%C3%A9s-non\">Le projet reste, les fonctionnalités non</a></p>\n<ul>\n<li><a href=\"#lab-testing\">L’A/B testing</a></li>\n<li><a href=\"#le-futur-flipping\">Le <em>futur flipping</em></a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#monitorer-mesurer-alerter\">Monitorer, Mesurer, Alerter</a></p>\n</li>\n<li>\n<p><a href=\"#limiter-surveiller-et-mettre-%C3%A0-jour-ses-d%C3%A9pendances\">Limiter, surveiller et mettre à jour ses dépendances</a></p>\n</li>\n<li>\n<p><a href=\"#accepter-sa-dette-technique\">Accepter sa dette technique</a></p>\n</li>\n<li>\n<p><a href=\"#pour-r%C3%A9sumer\">Pour résumer</a></p>\n</li>\n</ul>","frontmatter":{"title":"Bonnes pratiques pour la maintenance d'une application web","date":"August 25, 2021","dateJson":"2021-08-25","translations":["en","how-not-to-throw-away-your-web-application-after-two-years"],"description":"Comment ne pas jeter son projet au bout de 2 ans ? Retour d'expérience basé sur les bonnes pratiques appliquées à la plateforme web développée chez Bedrock Streaming.","language":"fr","tags":["web","javascript","bedrock"],"hero":{"childImageSharp":{"fluid":{"aspectRatio":1.7857142857142858,"src":"/static/706dca8ff24a680a04318fad5f7a023c/4fe8c/bedrock.jpg","srcSet":"/static/706dca8ff24a680a04318fad5f7a023c/aabdf/bedrock.jpg 150w,\n/static/706dca8ff24a680a04318fad5f7a023c/9dc27/bedrock.jpg 300w,\n/static/706dca8ff24a680a04318fad5f7a023c/4fe8c/bedrock.jpg 600w,\n/static/706dca8ff24a680a04318fad5f7a023c/9842e/bedrock.jpg 900w,\n/static/706dca8ff24a680a04318fad5f7a023c/47498/bedrock.jpg 1200w,\n/static/706dca8ff24a680a04318fad5f7a023c/d8255/bedrock.jpg 1920w","srcWebp":"/static/706dca8ff24a680a04318fad5f7a023c/ad85c/bedrock.webp","srcSetWebp":"/static/706dca8ff24a680a04318fad5f7a023c/e7487/bedrock.webp 150w,\n/static/706dca8ff24a680a04318fad5f7a023c/403a4/bedrock.webp 300w,\n/static/706dca8ff24a680a04318fad5f7a023c/ad85c/bedrock.webp 600w,\n/static/706dca8ff24a680a04318fad5f7a023c/210c1/bedrock.webp 900w,\n/static/706dca8ff24a680a04318fad5f7a023c/99238/bedrock.webp 1200w,\n/static/706dca8ff24a680a04318fad5f7a023c/25f09/bedrock.webp 1920w","sizes":"(max-width: 600px) 100vw, 600px"},"image":{"src":"/static/706dca8ff24a680a04318fad5f7a023c/10d63/bedrock.jpg"},"image16x9":{"src":"/static/706dca8ff24a680a04318fad5f7a023c/6edcc/bedrock.jpg"},"image4x3":{"src":"/static/706dca8ff24a680a04318fad5f7a023c/e14ae/bedrock.jpg"},"image1x1":{"src":"/static/706dca8ff24a680a04318fad5f7a023c/db124/bedrock.jpg"}}}}},"relatedPosts":{"edges":[{"node":{"excerpt":"Après 2 ans d’utilisation de React avec Redux pour la plateforme vidéo 6play, j’ai pu identifier les bonnes pratiques et les pièges à éviter…","fields":{"slug":"/fr/react-redux-pieges-bonnes-pratiques/"},"timeToRead":13,"frontmatter":{"title":"React/Redux : pièges et meilleures pratiques","date":"March 23, 2021","dateJson":"2021-03-23","description":"Nous utilisons React et Redux depuis presque 4 ans chez Bedrock sur notre plateforme vidéo nommée 6play. Les bonnes pratiques et les erreurs à éviter ont été rassemblées dans cet article.","tags":["react","redux","web"]}}},{"node":{"excerpt":"Cela fait plusieurs années que je joue avec les bundlers JS.\nRestant convaincu de la nécessité de l’usage de ces outils (ne me laissez pas…","fields":{"slug":"/fr/esbuild-bundler-incroyablement-rapide-et-prometteur/"},"timeToRead":6,"frontmatter":{"title":"Esbuild, le bundler incroyablement rapide 💨 et prometteur 📈 !","date":"March 14, 2021","dateJson":"2021-03-14","description":"Jouant avec les bundler traditionnels comme webpack depuis plusieurs années, je vous propose ici mon avis sur le bundler esbuild.","tags":["webpack","javascript","bundler"]}}},{"node":{"excerpt":"Cette fin d’année scolaire en tant que professeur à la fac n’est pas très habituelle.\nD’ici quelques jours, je m’apprête à donner mes…","fields":{"slug":"/fr/gol-hommage/"},"timeToRead":2,"frontmatter":{"title":"Hommage personnel au \"Game of Life\" (Jeu de la vie)","date":"April 20, 2020","dateJson":"2020-04-20","description":"Essai d'implémentation du Jeu de la Vie en Javascript dans le navigateur et sans framework.","tags":["javascript","canvas"]}}}]}},"pageContext":{"slug":"/fr/comment-ne-pas-jeter-son-application-au-bout-de-deux-ans/","tags":["web","javascript","bedrock"],"language":"fr","previous":{"fields":{"slug":"/fr/comment-mettre-en-place-des-tests-bout-en-bout-avec-webdriverio/"},"frontmatter":{"title":"Comment mettre en place des tests bout en bout avec WebdriverIo ?","tags":["github","action","e2e","WebdriverIo"]}},"next":null}},
    "staticQueryHashes": ["1264045386","1666466174","2564629789","4061151221","62118570"]}