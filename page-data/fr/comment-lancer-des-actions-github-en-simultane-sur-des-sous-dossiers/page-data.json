{"componentChunkName":"component---src-templates-blog-post-js","path":"/fr/comment-lancer-des-actions-github-en-simultane-sur-des-sous-dossiers/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://slashgear.github.io"}},"config":{"html":"<p>Ecrit par <strong>Antoine Caron</strong> qui vit et travaille à Lyon et développe des choses utiles à <a href=\"https://www.bedrockstreaming.com/\">Bedrock</a>.\nTu devrais le suivre sur <a href=\"https://twitter.com/Slashgear_\">Twitter</a></p>","fields":{"slug":"/fr/"},"frontmatter":{"title":"Antoine Caron","language":"fr"}},"markdownRemark":{"id":"dfece0c4-0bed-5a5a-9c30-93d775729120","excerpt":"Encore une fois, je me suis donné un challenge pour apprendre à utiliser Github Action.\nJ’ai essayé de voir s’il était possible de lancer…","html":"<p>Encore une fois, je me suis donné un challenge pour apprendre à utiliser Github Action.\nJ’ai essayé de voir s’il était possible de lancer dynamiquement un job pour chaque dossier dans un répertoire.</p>\n<p>On est souvent amené à vouloir paralléliser l’exécution des tests pour réduire le temps de l’intégration continue.\nSouvent les outils comme <code class=\"language-text\">Jest</code> ou <code class=\"language-text\">CucumberJS</code> possèdent des fonctionnalités de parrallélisation mais celles-ci confrontent souvent les limites de la puissance des machines sur lesquelles on souhaite les lancer.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">tests/\n  user/\n    foo.feature\n    bar.feature\n  account/\n    example.feature\n  live/\n    a.feature\n    video.feature</code></pre></div>\n<p>Je me suis demandé si il ne serait pas plus performant de paralléliser le lancement des tests directement grâce à l’outil de CI pour n’avoir besoin que de petits <em>runners</em>.\nDans l’exemple précédent, j’aimerais pouvoir lancer en parallèle sur un <em>runner</em> distinct pour chaque dossier dans <code class=\"language-text\">test/</code>.</p>\n<h2 id=\"une-solution-avec-les-github-action\" style=\"position:relative;\"><a href=\"#une-solution-avec-les-github-action\" aria-label=\"une solution avec les github action permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Une Solution avec les <em>Github action</em></h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> CI\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">directories</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># Job that list subdirectories</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">outputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">dir</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> steps.set<span class=\"token punctuation\">-</span>dirs.outputs.dir <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token comment\"># generate output name dir by using inner step output</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> set<span class=\"token punctuation\">-</span>dirs <span class=\"token comment\"># Give it an id to handle to get step outputs in the outputs key above</span>\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> echo \"<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>set<span class=\"token punctuation\">-</span>output name=dir<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>$(ls <span class=\"token punctuation\">-</span>d <span class=\"token important\">*/</span> <span class=\"token punctuation\">|</span> jq <span class=\"token punctuation\">-</span>R <span class=\"token punctuation\">-</span>s <span class=\"token punctuation\">-</span>c 'split(\"\\n\")<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">-1</span><span class=\"token punctuation\">]</span>')\"\n        <span class=\"token comment\"># Define step output named dir base on ls command transformed to JSON thanks to jq</span>\n  <span class=\"token key atrule\">loop</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">needs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>directories<span class=\"token punctuation\">]</span> <span class=\"token comment\"># Depends on previous job</span>\n    <span class=\"token key atrule\">strategy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">matrix</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">dir</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>fromJson(needs.directories.outputs.dir)<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token comment\"># List matrix strategy from directories dynamically</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> echo $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>matrix.dir<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>À vous de l’adapter à vos besoins !</p>","headings":[{"value":"Une Solution avec les Github action"}],"wordCount":{"words":136},"tableOfContents":"<ul>\n<li><a href=\"/fr/comment-lancer-des-actions-github-en-simultane-sur-des-sous-dossiers/#une-solution-avec-les-github-action\">Une Solution avec les <em>Github action</em></a></li>\n</ul>","frontmatter":{"title":"Github Action : Comment paralléliser ses tests dynamiquement par dossier ?","date":"December 01, 2020","dateJson":"2020-12-01","translations":["en","how-to-split-test-by-folder-with-github-action"],"description":"Encore une fois, je joue avec les Github Action pour voir si elles peuvent répondre aux problématiques de CI que je peux rencontrer dans mon travail.","language":"fr","tags":["github","action","CI","tutoriel"],"hero":{"childImageSharp":{"fluid":{"aspectRatio":1.9083969465648856,"src":"/static/ff44249e8985e61cdbe670afb0139b18/a7715/github-actions.jpg","srcSet":"/static/ff44249e8985e61cdbe670afb0139b18/8f7df/github-actions.jpg 250w,\n/static/ff44249e8985e61cdbe670afb0139b18/0f3a1/github-actions.jpg 500w,\n/static/ff44249e8985e61cdbe670afb0139b18/a7715/github-actions.jpg 1000w,\n/static/ff44249e8985e61cdbe670afb0139b18/47498/github-actions.jpg 1200w","srcWebp":"/static/ff44249e8985e61cdbe670afb0139b18/e30b5/github-actions.webp","srcSetWebp":"/static/ff44249e8985e61cdbe670afb0139b18/7ca0e/github-actions.webp 250w,\n/static/ff44249e8985e61cdbe670afb0139b18/e9589/github-actions.webp 500w,\n/static/ff44249e8985e61cdbe670afb0139b18/e30b5/github-actions.webp 1000w,\n/static/ff44249e8985e61cdbe670afb0139b18/99238/github-actions.webp 1200w","sizes":"(max-width: 1000px) 100vw, 1000px"},"image":{"src":"/static/ff44249e8985e61cdbe670afb0139b18/10d63/github-actions.jpg"},"image16x9":{"src":"/static/ff44249e8985e61cdbe670afb0139b18/6edcc/github-actions.jpg"},"image4x3":{"src":"/static/ff44249e8985e61cdbe670afb0139b18/e14ae/github-actions.jpg"},"image1x1":{"src":"/static/ff44249e8985e61cdbe670afb0139b18/db124/github-actions.jpg"}}}}},"relatedPosts":{"edges":[{"node":{"excerpt":"Depuis quelque temps, je joue avec les actions github pour voir si je peux facilement reproduire les comportements que j’applique dans mon…","fields":{"slug":"/fr/comment-parralelliser-un-job-github-action-par-label/"},"timeToRead":2,"frontmatter":{"title":"Github Action : Comment gérer dynamiquement des steps pour chaque label de Pull Request ?","date":"November 29, 2020","dateJson":"2020-11-29","description":"Depuis quelque temps, je joue avec les actions github pour voir si je peux facilement reproduire les comportements que j'applique dans mon outil de CI actuel. Je voulais mettre en parallèle les tâches sur chaque label de Pull Request.","tags":["github","action","CI","tutoriel"]}}},{"node":{"excerpt":"Github Pages est une solution pour héberger des sites web statiques directement dans ton dépôt Github en poussant les fichiers du site vers…","fields":{"slug":"/fr/comment-deployer-sur-github-pages-avec-travis-ci/"},"timeToRead":2,"frontmatter":{"title":"Comment se déployer sur les pages Github avec Travis CI ?","date":"May 26, 2020","dateJson":"2020-05-26","description":"Comment automatiser en quelques minutes le déploiement de votre site sur les pages Github avec l'outil Travis CI. Ce tutoriel décrit étape par étape toutes les actions à effectuer pour publier un site statique sur des pages Github et l'héberger gratuitement.","tags":["tutoriel","github","gatsby"]}}},{"node":{"excerpt":"Lorsque j’ai commencé à enseigner en septembre dernier, je recherchais une solution\npour pouvoir suivre facilement l’avancée des étudiants…","fields":{"slug":"/fr/github-classroom/"},"timeToRead":6,"frontmatter":{"title":"Github classroom - un outil à tester","date":"March 25, 2017","dateJson":"2017-03-25","description":"J'ai récemment essayé Github Classroom avec mes étudiants de 4ème année de l'école Polytech Lyon. Je vous propose ici mes retours sur cet outil à destination des enseignants pour le suivi de TP.","tags":["formation","git","github"]}}}]}},"pageContext":{"slug":"/fr/comment-lancer-des-actions-github-en-simultane-sur-des-sous-dossiers/","tags":["github","action","CI","tutoriel"],"language":"fr","previous":{"fields":{"slug":"/fr/comment-parralelliser-un-job-github-action-par-label/"},"frontmatter":{"title":"Github Action : Comment gérer dynamiquement des steps pour chaque label de Pull Request ?","tags":["github","action","CI","tutoriel"]}},"next":null}},"staticQueryHashes":["1264045386","1666466174","4061151221"]}